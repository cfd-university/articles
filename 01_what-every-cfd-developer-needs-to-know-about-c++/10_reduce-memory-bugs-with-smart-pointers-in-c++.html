<!-- wp:paragraph -->
<p>This article will look into smart pointers and why we should use them over raw pointers in C++. Smart pointers are fundamental building blocks in C++ and after 2014, ever C++ programmer should be using smart pointers instead of raw pointers, there are no excuses for raw pointers (anymore). Throughout this article, we explore how we would use smart pointers in real CFD applications, where we look at creating a solver class based on either the SIMPLE or PISO algorithm. We explore how smart pointers can be used in conjunction with the factory design pattern to create clean code and also touch upon two import C++ concepts, namely copy elision and return value optimisation, to help us with memory management.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this series</h2>
<!-- /wp:heading -->

<!-- wp:shortcode -->
[custom_category_posts_list category_slug="what-every-cfd-developer-needs-to-know-about-c"]
<!-- /wp:shortcode -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this article</h2>
<!-- /wp:heading -->

<!-- wp:aioseo/table-of-contents {"headings":[{"id":5,"blockClientId":"24ee199f-f2c4-4899-9436-0db0d566a58c","content":"Life before smart pointers: Problems with raw pointers","level":2,"anchor":"aioseo-intro","order":0,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":14,"blockClientId":"4ab20c59-fc5a-406a-b9b0-b9b6f258441f","content":"Setting limits for our variables: Scoping","level":3,"anchor":"aioseo-scoping-in-c","order":1,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":29,"blockClientId":"1f16e314-b4e4-4d11-8314-538c02978405","content":"Why is calling new and delete bad?","level":3,"anchor":"aioseo-smart-pointers-to-the-rescue","order":2,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":35,"blockClientId":"f31245ac-64d2-4274-8102-bca299042f62","content":"Smart pointers to the rescue","level":2,"anchor":"aioseo-smart-pointers-to-the-rescue","order":3,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":44,"blockClientId":"a173011c-b0be-4219-9080-8b60e14e5590","content":"Creating a SIMPLE or PISO solver the right way with shared pointers","level":3,"anchor":"aioseo-creating-a-simple-or-piso-solver-the-right-way-with-shared-pointers","order":4,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":49,"blockClientId":"862444d2-be83-49c4-ad1a-919c4dcf1021","content":"Introducing the factory pattern with smart pointers","level":3,"anchor":"aioseo-smart-pointers-and-the-factory-pattern-for-clean-code","order":5,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":60,"blockClientId":"2f970111-693c-4810-9d14-58cbe2605c3a","content":"Not so-smart smart pointers in OpenFOAM","level":2,"anchor":"aioseo-not-so-smart-smart-pointers-in-openfoam","order":6,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":65,"blockClientId":"9d0cbf3c-5515-4b83-a95c-017754bd4893","content":"Summary","level":2,"anchor":"aioseo-summary","order":7,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]} -->
<div class="wp-block-aioseo-table-of-contents"><ul><li><a href="#aioseo-intro">Life before smart pointers: Problems with raw pointers</a><ul><li><a href="#aioseo-scoping-in-c">Setting limits for our variables: Scoping</a></li><li><a href="#aioseo-smart-pointers-to-the-rescue">Why is calling new and delete bad?</a></li></ul></li><li><a href="#aioseo-smart-pointers-to-the-rescue">Smart pointers to the rescue</a><ul><li><a href="#aioseo-creating-a-simple-or-piso-solver-the-right-way-with-shared-pointers">Creating a SIMPLE or PISO solver the right way with shared pointers</a></li><li><a href="#aioseo-smart-pointers-and-the-factory-pattern-for-clean-code">Introducing the factory pattern with smart pointers</a></li></ul></li><li><a href="#aioseo-not-so-smart-smart-pointers-in-openfoam">Not so-smart smart pointers in OpenFOAM</a></li><li><a href="#aioseo-summary">Summary</a></li></ul></div>
<!-- /wp:aioseo/table-of-contents -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-intro">Life before smart pointers: Problems with raw pointers</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>To understand <code>smart pointers</code>, we first need to revisit raw pointers or classical C-style pointers. We looked at them briefly in the <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/understanding-memory-management-in-c" target="_blank" rel="noopener" title="">Understanding memory in C++</a>, but we are going to extend that discussion. Let us start with a simple example:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;iostream\u003e\n\nint main()\n{\n  int *pointer = new int[1];\n  pointer[0] = 42;\n  std::cout \u0026lt;\u0026lt; pointer[0] \u0026lt;\u0026lt; std::endl;\n  delete [] pointer;\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e *pointer = \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003enew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003epointer\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e] = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e42\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003epointer\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e] \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003edelete\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e[]\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e pointer;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":10,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;iostream&gt;

int main()
{
  int *pointer = new int[1];
  pointer[0] = 42;
  std::cout &lt;&lt; pointer[0] &lt;&lt; std::endl;
  delete [] pointer;
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> *pointer = </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">];</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">pointer</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">] = </span><span style="color: #B5CEA8">42</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; </span><span style="color: #9CDCFE">pointer</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">] &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">delete</span><span style="color: #569CD6"> </span><span style="color: #C586C0">[]</span><span style="color: #D4D4D4"> pointer;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Nothing interesting is happening here, really. We create a pointer on line 5 which has exactly one <code>int</code>, so somewhere in memory 4 bytes are allocated for us. On line 6, we set the first entry (we only have one) to 42 and verify that it has worked on line 7. Finally, we deallocate memory, and we <em>always</em> need to call a matching <code>delete</code> for every <code>new</code> operation we call.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In C, we typically use pointers to help us with one- or multi-dimensional arrays, e.g.:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;iostream\u003e\n\nint main()\n{\n  int nx = 10; int ny = 10;\n  \n  // velocity vector in the x direction\n  double **velocityX = new double*[nx];\n  for (int i = 0; i \u0026lt; nx; ++i) {\n    velocityX[i] = new double[ny];\n    for (int j = 0; j \u0026lt; ny; ++j) {\n      velocityX[i][j] = 0.0;\n    }\n  }\n\n  // done with work on u\n  for (int i = 0; i \u0026lt; nx; ++i) {\n    delete [] velocityX[i];\n  }\n  delete [] velocityX;\n\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e nx = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e10\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e ny = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e10\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // velocity vector in the x direction\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e **velocityX = \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003enew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e*[nx];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; nx; ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003evelocityX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] = \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003enew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[ny];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e j = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; j \u0026lt; ny; ++j) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003evelocityX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i][j] = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // done with work on u\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; nx; ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003edelete\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e[]\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003evelocityX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003edelete\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e[]\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e velocityX;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":23,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;iostream&gt;

int main()
{
  int nx = 10; int ny = 10;
  
  // velocity vector in the x direction
  double **velocityX = new double*[nx];
  for (int i = 0; i &lt; nx; ++i) {
    velocityX[i] = new double[ny];
    for (int j = 0; j &lt; ny; ++j) {
      velocityX[i][j] = 0.0;
    }
  }

  // done with work on u
  for (int i = 0; i &lt; nx; ++i) {
    delete [] velocityX[i];
  }
  delete [] velocityX;

  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> nx = </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">; </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> ny = </span><span style="color: #B5CEA8">10</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #6A9955">  // velocity vector in the x direction</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> **velocityX = </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">*[nx];</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; nx; ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">velocityX</span><span style="color: #D4D4D4">[i] = </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">[ny];</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> j = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; j &lt; ny; ++j) {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">velocityX</span><span style="color: #D4D4D4">[i][j] = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // done with work on u</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; nx; ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">delete</span><span style="color: #569CD6"> </span><span style="color: #C586C0">[]</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">velocityX</span><span style="color: #D4D4D4">[i];</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">delete</span><span style="color: #569CD6"> </span><span style="color: #C586C0">[]</span><span style="color: #D4D4D4"> velocityX;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Here, we define a two-dimensional array <code>velocityX</code> on line 8, which represents the velocity component in the x-direction. We can see that it is two-dimensional by the leading two asterisks, e.g. <code>**</code>. We then loop over all entries in the x-direction, allocate memory on the way, and then loop over the y-direction and assign a zero velocity field everywhere. Once we are done, we have to go through the same loop, deallocate memory, and call the same number of <code>delete</code> operators as <code>new</code> operators.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Moving to C++, hopefully, by now you look at this and think that this looks <em>ugly</em> and should be better handled with data structures, for example a <code>std::vector</code>, and you would be right. C++ comes with the standard template library and this provides us, out of the box, with a comprehensive list of useful data structures and algorithms, which we looked at in our article on the <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/the-power-of-the-standard-template-library-stl-in-c" target="_blank" rel="noopener" title="">standard template library</a> earlier. If we were to use a <code>std::vector</code> here, we would have no more calls to <code>new</code> and <code>delete</code>, this is hidden within its implementation for us. The reason we have to use the above construct in C is that we do not have anything better available. We can't write our own custom classes to hide memory allocation in the constructor and destructor, as classes don't exist in C. In C++, we should never use raw pointers like this.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>But sometimes, we still need to use pointers, and the reason is subtle, but worth exploring. All the way back in the <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/understanding-memory-management-in-c" target="_blank" rel="noopener" title="">Understanding memory in C++</a> article, we looked at how to allocate memory on the stack and heap. We said that stack memory is used if we declare variables as non-pointers, whereas pointers (using the keyword new) are allocated on the heap. There is a difference in behaviour between the two. Variables on the stack will automatically be deleted when they go out of scope, whereas <em>heap</em>-allocated variables will only be deleted when we call the <code>delete</code> operator.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-scoping-in-c">Setting limits for our variables: Scoping</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>What is a scope then? A scope is bound by the {} braces. So, for example, everything inside a function is enclosed by {} braces. If we define a variable within this function, once we return from it, the variable will no longer be available to us if it was allocated on the stack. But we can also randomly throw around braces in code to limit the scope, such as:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;iostream\u003e\n\nint main()\n{\n  int a = 42;\n  {\n    int b = 27;\n  }\n  std::cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; std::endl;\n  std::cout \u0026lt;\u0026lt; b \u0026lt;\u0026lt; std::endl;\n\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e a = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e42\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e b = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e27\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; b \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","seeMoreType":"","seeMoreString":"","seeMoreTransition":false,"highestLineNumber":13,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;iostream&gt;

int main()
{
  int a = 42;
  {
    int b = 27;
  }
  std::cout &lt;&lt; a &lt;&lt; std::endl;
  std::cout &lt;&lt; b &lt;&lt; std::endl;

  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> a = </span><span style="color: #B5CEA8">42</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> b = </span><span style="color: #B5CEA8">27</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; a &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; b &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>This code will produce an error because we defined <code>b</code> within a block of <code>{}</code> braces, so on line 10, when we try to call <code>b</code>, the compiler says that it doesn't know what you mean, there is no variable <code>b</code> defined. Let's have a quick look at OpenFOAM, where braces and scope are thrown away quite frequently, and it bamboozles me why it is done. The following example is taken from the <a href="https://develop.openfoam.com/Development/openfoam/-/blob/OpenFOAM-v2306/applications/solvers/incompressible/simpleFoam/simpleFoam.C?ref_type=tags" target="_blank" rel="noopener" title="">SIMPLE algorithm</a> (file: <code>simpleFoam.C</code>) implementation of OpenFOAM (just an excerpt):</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"while (simple.loop())\n{\n    Info\u0026lt;\u0026lt; \u0022Time = \u0022 \u0026lt;\u0026lt; runTime.timeName() \u0026lt;\u0026lt; nl \u0026lt;\u0026lt; endl;\n\n    // \u002d\u002d- Pressure-velocity SIMPLE corrector\n    {\n        #include \u0022UEqn.H\u0022\n        #include \u0022pEqn.H\u0022\n    }\n\n    laminarTransport.correct();\n    turbulence-\u003ecorrect();\n\n    runTime.write();\n\n    runTime.printExecutionTime(Info);\n}\n","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ewhile\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003esimple\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eloop\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    Info\u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Time = \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erunTime\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etimeName\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt;\u0026lt; nl \u0026lt;\u0026lt; endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e    // \u002d\u002d- Pressure-velocity SIMPLE corrector\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e        \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;UEqn.H\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e        \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;pEqn.H\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003elaminarTransport\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ecorrect\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eturbulence\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ecorrect\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erunTime\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ewrite\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erunTime\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eprintExecutionTime\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(Info);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":18,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="while (simple.loop())
{
    Info&lt;&lt; &quot;Time = &quot; &lt;&lt; runTime.timeName() &lt;&lt; nl &lt;&lt; endl;

    // --- Pressure-velocity SIMPLE corrector
    {
        #include &quot;UEqn.H&quot;
        #include &quot;pEqn.H&quot;
    }

    laminarTransport.correct();
    turbulence-&gt;correct();

    runTime.write();

    runTime.printExecutionTime(Info);
}
" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">while</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">simple</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">loop</span><span style="color: #D4D4D4">())</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">    Info&lt;&lt; </span><span style="color: #CE9178">&quot;Time = &quot;</span><span style="color: #D4D4D4"> &lt;&lt; </span><span style="color: #9CDCFE">runTime</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">timeName</span><span style="color: #D4D4D4">() &lt;&lt; nl &lt;&lt; endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">    // --- Pressure-velocity SIMPLE corrector</span></span>
<span class="line"><span style="color: #D4D4D4">    {</span></span>
<span class="line"><span style="color: #569CD6">        </span><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;UEqn.H&quot;</span></span>
<span class="line"><span style="color: #569CD6">        </span><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;pEqn.H&quot;</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">laminarTransport</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">correct</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">turbulence</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">correct</span><span style="color: #D4D4D4">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">runTime</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">write</span><span style="color: #D4D4D4">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">runTime</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">printExecutionTime</span><span style="color: #D4D4D4">(Info);</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>We can see a scope being generated on lines 6 to 9. Worse still, if you go into the <code>pEqn.H</code> file, you'll see that it is also scoped, i.e. the first and last lines are enclosed in <code>{ }</code>, but the <code>UEqn.H</code> file isn't. I have looked at this code several times now and I can still not see a programming reason why this is necessary. I assume this is done for style or looks, not for practical reasons, and yet, this is one of those instances where I really don't understand why OpenFOAM has taken the decision to write their code in this particular way. There are other examples, and I'm sure I'll unearth some more of them in the future. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>After looking at so many <em>bad</em> examples of scoping, let's finally look at something more realistic and discuss why scoping can become a problem. A more realistic scenario that you may encounter in a CFD solver is shown below:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;iostream\u003e\n#include \u0026lt;string\u003e\n\nclass Solver {\npublic:\n  virtual void solve() = 0;\n};\n\nclass SIMPLE : public Solver {\npublic:\n  virtual void solve() final { /* ...*/ }\n};\n\nclass PISO : public Solver {\npublic:\n  virtual void solve() final { /* ...*/ }\n};\n\nint main()\n{\n  std::string name(\u0022SIMPLE\u0022);\n\n  if (name == \u0022SIMPLE\u0022) {\n    SIMPLE solver;\n  } else if (name == \u0022PISO\u0022) {\n    PISO solver;\n  }\n  solver.solve();\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;string\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSIMPLE\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e : \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efinal\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e /* ...*/\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003ePISO\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e : \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efinal\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e /* ...*/\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::string \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ename\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    SIMPLE solver;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eelse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;PISO\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    PISO solver;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003esolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":30,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;iostream&gt;
#include &lt;string&gt;

class Solver {
public:
  virtual void solve() = 0;
};

class SIMPLE : public Solver {
public:
  virtual void solve() final { /* ...*/ }
};

class PISO : public Solver {
public:
  virtual void solve() final { /* ...*/ }
};

int main()
{
  std::string name(&quot;SIMPLE&quot;);

  if (name == &quot;SIMPLE&quot;) {
    SIMPLE solver;
  } else if (name == &quot;PISO&quot;) {
    PISO solver;
  }
  solver.solve();
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;string&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SIMPLE</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> {</span><span style="color: #6A9955"> /* ...*/</span><span style="color: #D4D4D4"> }</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">PISO</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> {</span><span style="color: #6A9955"> /* ...*/</span><span style="color: #D4D4D4"> }</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::string </span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    SIMPLE solver;</span></span>
<span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;PISO&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    PISO solver;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">solver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Here, we declare an abstract base class <code>Solver</code> on line 4, which defines a pure virtual function on line 6. We then go on to derive two classes from this, the SIMPLE and PISO class, which would then implement a way to solve for velocity and pressure within the solve function on lines 11 and 16, respectively.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If we now want to create a solver based on a name that we, for example, read from a parameter file as simulated on line 21, then we are in trouble if we want to solve this with the if/else construct shown on lines 23-27. You may have noticed that we are trying to define a variable called <code>solver</code> to be either of type <code>SIMPLE</code> or <code>PISO</code> based on the name variable, but we are trying to allocate the solver variable on the stack. Hence, once the if/else statement is done, the <code>solver</code> variable will be deleted from the stack, as we have reached the end of the <code>{ }</code> braces. Subsequently, the above-provided code will not compile and complain about line 28, as <code>solver</code> is no longer defined.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>What do we do? Of course, pointers to the rescue, we allocate on the heap and ignore scope entirely. Remember that variables allocated on the heap do not have a scope associated with them and so we have to explicitly call the <code>delete</code> keyword when we want them to go out of scope. Focusing just on the <code>main</code> function, the new implementation would look something like:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"int main()\n{\n  std::string name(\u0022SIMPLE\u0022);\n  Solver *solver = nullptr;\n\n  if (name == \u0022SIMPLE\u0022) {\n    solver = new SIMPLE();\n  } else if (name == \u0022PISO\u0022) {\n    solver = new PISO();\n  }\n  solver-\u003esolve();\n  \n  // clean up after yourself\n  delete [] solver;\n  solver = nullptr;\n  \n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::string \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ename\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Solver *solver = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enullptr\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003enew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eSIMPLE\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eelse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;PISO\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003enew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ePISO\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003esolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // clean up after yourself\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003edelete\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e[]\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e solver;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  solver = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enullptr\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":18,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="int main()
{
  std::string name(&quot;SIMPLE&quot;);
  Solver *solver = nullptr;

  if (name == &quot;SIMPLE&quot;) {
    solver = new SIMPLE();
  } else if (name == &quot;PISO&quot;) {
    solver = new PISO();
  }
  solver-&gt;solve();
  
  // clean up after yourself
  delete [] solver;
  solver = nullptr;
  
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::string </span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  Solver *solver = </span><span style="color: #569CD6">nullptr</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">SIMPLE</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;PISO&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #C586C0">new</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">PISO</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">solver</span><span style="color: #D4D4D4">-&gt;</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #6A9955">  // clean up after yourself</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">delete</span><span style="color: #569CD6"> </span><span style="color: #C586C0">[]</span><span style="color: #D4D4D4"> solver;</span></span>
<span class="line"><span style="color: #D4D4D4">  solver = </span><span style="color: #569CD6">nullptr</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Now we are generating a pointer on line 4, which we initially set to a null pointer (good practice, always initialise your variables with a default value). Then, during the if/else construct, we allocate memory for this variable which now is of our custom type SIMPLE or PISO (remember, a class is nothing else than a type in C++ and they allow us to extend C++ with our own types). Since we allocate them on the heap through the new operator, they will persist beyond the if/else scope and the call on line 11 to the <code>solve</code> method will now work, though we had to change from the dot (<code>.</code>) to the arrow (<code>-&gt;</code>) operator in order to call the function, which is just the way we have to interact with pointers.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As we have discussed further above, we never want to handle memory calls to <code>new</code> and <code>delete</code> ourselves, unless we know what we are doing. This implies that you do understand how to write custom memory allocators and how you pass them to data structures such as <code>std::vector</code>s as template arguments. If this feels complicated, then you are probably not ready yet to deal with <code>new</code> and <code>delete</code> just yet, but the good news is you don't have to. If you want to explore what it takes to write your own memory allocator for your own data structure, then I would recommend the talk by Bob Steagall on this:</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.youtube.com/watch?v=kSWfushlvB8","type":"video","providerNameSlug":"youtube","responsive":true,"className":"wp-embed-aspect-16-9 wp-has-aspect-ratio"} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://www.youtube.com/watch?v=kSWfushlvB8
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-smart-pointers-to-the-rescue">Why is calling new and delete bad?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We are now in a dilemma; we can see the usefulness of pointers in the above example (and we will return to it, as this is an important design pattern), but we do not want to use <code>new</code> and <code>delete</code> ourselves. You may ask yourself at this point, why <code>new</code> and <code>delete</code> is so bad? I'd answer that question with it is just good practice. If you look around, a lot of companies where bugs could lead to catastrophic events, specifically discourage (or forbid) the use of <code>new</code> and <code>delete</code>. Think of airborne applications, such as space shuttles and aircraft. A memory bug here with potential undefined behaviour, would lead to a catastrophic outcome (and has, in the past).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you are unaware, the the <a href="https://en.wikipedia.org/wiki/Ariane_flight_V88" target="_blank" rel="noopener" title="">Ariane 5 rocket explode just after launch</a> due to a conversion issue from a 64-bit floating point number to a 16-bit unsigned integer. The issue was that the conversion happened with values that were too great to represent by a 16-bit unsigned integer and so an overflow occurred, bringing down the rocket. Aerospace and astronautical companies are known for their distrust of the programmers' abilities to handle memory correctly (probably for good reasons!) and usually put guidelines in place that prohibit code that could easily lead to memory bugs. Take a look at the <a href="https://www.stroustrup.com/JSF-AV-rules.pdf" target="_blank" rel="noopener" title="">Joint Strike Fighter Air Vehicle C++ Coding Standart by Lookheed Martin</a>, for example, which is accessible to the public. On page 59, they state:</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:heading -->
<h2 class="wp-block-heading">4.26 Memory Allocation</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">AV Rule 206 (MISRA Rule 118, Revised)</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Allocation/deallocation from/to the free store (heap) <strong>shall not</strong> occur after initialization. Note that the placement operator new(), although not technically dynamic memory, may only be used in low-level memory management routines. See AV Rule 70.1 for object lifetime issues associated with placement operator new().</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Rationale</strong>: repeated allocation (new/malloc) and deallocation (delete/free) from the free store/heap can result in free store/heap fragmentation and hence non-deterministic delays in free store/heap access. See Alloc.doc for alternatives.</p>
<!-- /wp:paragraph --><cite><a href="https://www.stroustrup.com/JSF-AV-rules.pdf" target="_blank" rel="noopener" title="">Joint Strike Fighter Air Vehicle C++ Coding Standart by Lookheed Martin</a></cite></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>I'd say their language is rather permissive, they say that a call to new shall not occur, but if you have good reasons to do so, you can, If you do, though, you have to resort to something like custom memory allocators as discussed above, i.e. low-level memory management. You still can't throw around <code>new</code> and <code>delete</code> statements anywhere in the code. It is interesting to read that they state memory fragmentation as the reason, i.e. fragmented memory can lead to longer look-up times, which probably makes sense. So in their case, you are not allowed to use <code>new</code> and <code>delete</code> for performance reasons, not for security reasons. However, there are other examples where the guidelines restrict the usage of certain features to ensure memory bugs are kept to a minimum.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Okay, so we don't want to deal with memory allocation and deallocation ourselves. Using a data structure (container) from the standard template library will cover most use cases, but what about cases like the one we encountered above with our <code>SIMPLE</code> and <code>PISO</code> class example? Well, we are finally primed and ready for smart pointers in C++!</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-smart-pointers-to-the-rescue">Smart pointers to the rescue</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Smart pointers work exactly like pointers themselves, but these pointers are implemented as classes and so have a few more things in store for us. And, to complicate things further, we have three different types, of which you only really need to understand and use two (I have never used the third one, nor seen it anywhere in code). The three different types are <code>unique</code>, <code>shared</code>, and <code>weak</code> pointers.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The difference between all these different smart pointers is ownership. A <code>unique</code> pointer can only be owned by a single variable, i.e. you can't create a second variable that points to the same memory address by assigning the <code>unique</code> pointer to the second variable. A <code>shared</code> pointer, then, is the opposite, you can have many variables (pointers) point to the same memory, which makes it very easy to share resources (e.g. keep a copy of that pointer in several classes). A <code>shared</code> pointer will count how many variables are currently pointing to the same memory address, and, once all references to that memory address are deleted, the <code>shared</code> pointer itself is deleted.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Whenever you deal with multiple owners, you may run into issues with circular references, e.g. pointer <code>A</code> is pointing to <code>B</code>, <code>B</code> is pointing to <code>C</code>, and <code>C</code> is pointing back at <code>A</code> again. In this case, the reference count will never decrease, and shared pointers will subsequently not be deallocated, causing memory leaks. For this reason, we have <code>weak</code> pointers, which can access <code>shared</code> pointers, but they do not increase the reference count of owners of the <code>shared</code> pointer. That also means that if we want to use a <code>weak</code> pointer, we need to check if the <code>shared</code> pointer actually still exists, but as I have mentioned above, <code>weak</code> pointers are rather <em>weakly</em> used (couldn't resist the pun).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This all sounds wonderfully abstract, so a few examples are in place to make things a bit clearer.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;memory\u003e\n\nint main()\n{\n  std::unique_ptr\u0026lt;double\u003e unique_ptr1 = std::make_unique\u0026lt;double\u003e(3.14);\n  // std::unique_ptr\u0026lt;double\u003e unique_ptr2 = unique_ptr1;\n  std::cout \u0026lt;\u0026lt; *unique_ptr1 \u0026lt;\u0026lt; std::endl; // prints 3.14\n\n  std::shared_ptr\u0026lt;double\u003e shared_ptr1 = std::make_shared\u0026lt;double\u003e(2.71);\n  std::cout \u0026lt;\u0026lt; *shared_ptr1 \u0026lt;\u0026lt; std::endl; // prints 2.71\n  std::cout \u0026lt;\u0026lt; shared_ptr1.use_count() \u0026lt;\u0026lt; std::endl; // prints 1\n  \n  std::shared_ptr\u0026lt;double\u003e shared_ptr2 = shared_ptr1;\n  std::cout \u0026lt;\u0026lt; shared_ptr1.use_count() \u0026lt;\u0026lt; std::endl; // prints 2\n\n  std::weak_ptr\u0026lt;double\u003e weak_ptr1 = shared_ptr1;\n  std::cout \u0026lt;\u0026lt; shared_ptr1.use_count() \u0026lt;\u0026lt; std::endl; // prints 2\n\n  if (auto lockedShared = weak_ptr1.lock()) {\n    std::cout \u0026lt;\u0026lt; *lockedShared \u0026lt;\u0026lt; std::endl; // prints 2.71\n  }\n  \n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;memory\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::unique_ptr\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; unique_ptr1 = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_unique\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e3.14\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // std::unique_ptr\u0026lt;double\u0026gt; unique_ptr2 = unique_ptr1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; *unique_ptr1 \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 3.14\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::shared_ptr\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; shared_ptr1 = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_shared\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.71\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; *shared_ptr1 \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 2.71\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eshared_ptr1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003euse_count\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::shared_ptr\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; shared_ptr2 = shared_ptr1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eshared_ptr1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003euse_count\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::weak_ptr\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; weak_ptr1 = shared_ptr1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eshared_ptr1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003euse_count\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e lockedShared = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eweak_ptr1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003elock\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; *lockedShared \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // prints 2.71\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","seeMoreType":"","seeMoreString":"","seeMoreTransition":false,"highestLineNumber":24,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;memory&gt;

int main()
{
  std::unique_ptr&lt;double&gt; unique_ptr1 = std::make_unique&lt;double&gt;(3.14);
  // std::unique_ptr&lt;double&gt; unique_ptr2 = unique_ptr1;
  std::cout &lt;&lt; *unique_ptr1 &lt;&lt; std::endl; // prints 3.14

  std::shared_ptr&lt;double&gt; shared_ptr1 = std::make_shared&lt;double&gt;(2.71);
  std::cout &lt;&lt; *shared_ptr1 &lt;&lt; std::endl; // prints 2.71
  std::cout &lt;&lt; shared_ptr1.use_count() &lt;&lt; std::endl; // prints 1
  
  std::shared_ptr&lt;double&gt; shared_ptr2 = shared_ptr1;
  std::cout &lt;&lt; shared_ptr1.use_count() &lt;&lt; std::endl; // prints 2

  std::weak_ptr&lt;double&gt; weak_ptr1 = shared_ptr1;
  std::cout &lt;&lt; shared_ptr1.use_count() &lt;&lt; std::endl; // prints 2

  if (auto lockedShared = weak_ptr1.lock()) {
    std::cout &lt;&lt; *lockedShared &lt;&lt; std::endl; // prints 2.71
  }
  
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;memory&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::unique_ptr&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; unique_ptr1 = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_unique</span><span style="color: #D4D4D4">&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt;(</span><span style="color: #B5CEA8">3.14</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #6A9955">  // std::unique_ptr&lt;double&gt; unique_ptr2 = unique_ptr1;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; *unique_ptr1 &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 3.14</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::shared_ptr&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; shared_ptr1 = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_shared</span><span style="color: #D4D4D4">&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt;(</span><span style="color: #B5CEA8">2.71</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; *shared_ptr1 &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 2.71</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; </span><span style="color: #9CDCFE">shared_ptr1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use_count</span><span style="color: #D4D4D4">() &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 1</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::shared_ptr&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; shared_ptr2 = shared_ptr1;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; </span><span style="color: #9CDCFE">shared_ptr1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use_count</span><span style="color: #D4D4D4">() &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::weak_ptr&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; weak_ptr1 = shared_ptr1;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; </span><span style="color: #9CDCFE">shared_ptr1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">use_count</span><span style="color: #D4D4D4">() &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> lockedShared = </span><span style="color: #9CDCFE">weak_ptr1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">lock</span><span style="color: #D4D4D4">()) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; *lockedShared &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span><span style="color: #6A9955"> // prints 2.71</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>In order to use smart pointers, we need to include the <code>&lt;memory&gt;</code> header. Lines 5-7 deal with <code>unique</code> pointers. On line 5, we first declare a <code>unique</code> pointer, which is of type <code>double</code>, and instead of calling <code>new</code> on the right-hand side of the assignment, we call <code>std::make_unique</code>, which handles memory allocation for us. Line 6 is commented out; if you were to remove the comment, the code would not compile anymore, as we can't assign a <code>unique</code> pointer to another one.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Lines 9-14 deal with <code>shared</code> pointers and illustrate the concept of ownership mentioned previously. We declare a <code>shared</code> pointer in a similar manner to <code>unique</code> pointers, in that we call <code>std::make_shared</code>, which handles memory allocation for us. On line 10, we show that when we dereference the pointer, we get the value printed to the screen that we assigned on line 9. Also, on line 11, we call the special function <code>use_count()</code>, which returns the number of owners of that pointer. At the point of creation, there is only one, so this will print 1 to the screen. We create a second <code>shared</code> pointer on line 13 and set it equal to the <code>shared</code> pointer we defined on line 9; when we now call the <code>use_count()</code> function on line 14, we now get 2 instead of 1 printed, as we just added another owner to the <code>shared</code> pointer. We are not printing here its value, but it would return the same value as printed on line 10.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Finally, on lines 16-21, we deal with <code>weak</code> pointers. We initialise it on line 16 and set it equal to the <code>shared</code> pointer. It will have the same value as <code>shared_ptr1</code> and <code>shared_ptr2</code>, but it will not increase the reference count; i.e. calling <code>use_count()</code> on <code>shared_ptr1</code> will still return 2, as shown on line 17. This means that since we are not owning the pointer, it could go out of scope and be deleted before we want to use it, so we need to check that it still exists before we use it. This is shown on lines 19-21, where we first check if we can lock our <code>weak</code> pointer. If so, it'll return <code>true</code>, and the <code>if</code> statement will be executed. If we want to access the content of the <code>weak</code> pointer, we need to use the newly created variable <code>lockedShared</code>, which can be used to dereference the value stored in the original <code>shared</code> pointer.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-creating-a-simple-or-piso-solver-the-right-way-with-shared-pointers">Creating a SIMPLE or PISO solver the right way with shared pointers</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>With that out of the way, let us return to our <code>SIMPLE</code> and <code>PISO</code> class example, but this time use a <code>unique</code> pointer instead of a raw pointer:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0026lt;iostream\u003e\n#include \u0026lt;string\u003e\n#include \u0026lt;memory\u003e\n\nclass Solver {\npublic:\n  virtual void solve() = 0;\n};\n\nclass SIMPLE : public Solver {\npublic:\n  virtual void solve() final { /* ...*/ }\n};\n\nclass PISO : public Solver {\npublic:\n  virtual void solve() final { /* ...*/ }\n};\n\nint main()\n{\n  std::string name(\u0022SIMPLE\u0022);\n  std::unique_ptr\u0026lt;Solver\u003e solver = nullptr;\n\n  if (name == \u0022SIMPLE\u0022) {\n    solver = std::make_unique\u0026lt;SIMPLE\u003e();\n  } else if (name == \u0022PISO\u0022) {\n    solver = std::make_unique\u0026lt;PISO\u003e();\n  }\n  solver.get()-\u003esolve();\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;string\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;memory\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSIMPLE\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e : \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efinal\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e /* ...*/\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003ePISO\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e : \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efinal\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e /* ...*/\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::string \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ename\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::unique_ptr\u0026lt;Solver\u0026gt; solver = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enullptr\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_unique\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSIMPLE\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eelse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;PISO\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_unique\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003ePISO\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003esolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eget\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()-\u0026gt;\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":32,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;memory&gt;

class Solver {
public:
  virtual void solve() = 0;
};

class SIMPLE : public Solver {
public:
  virtual void solve() final { /* ...*/ }
};

class PISO : public Solver {
public:
  virtual void solve() final { /* ...*/ }
};

int main()
{
  std::string name(&quot;SIMPLE&quot;);
  std::unique_ptr&lt;Solver&gt; solver = nullptr;

  if (name == &quot;SIMPLE&quot;) {
    solver = std::make_unique&lt;SIMPLE&gt;();
  } else if (name == &quot;PISO&quot;) {
    solver = std::make_unique&lt;PISO&gt;();
  }
  solver.get()-&gt;solve();
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;string&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;memory&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SIMPLE</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> {</span><span style="color: #6A9955"> /* ...*/</span><span style="color: #D4D4D4"> }</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">PISO</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> {</span><span style="color: #6A9955"> /* ...*/</span><span style="color: #D4D4D4"> }</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::string </span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::unique_ptr&lt;Solver&gt; solver = </span><span style="color: #569CD6">nullptr</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_unique</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">SIMPLE</span><span style="color: #D4D4D4">&gt;();</span></span>
<span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;PISO&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_unique</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">PISO</span><span style="color: #D4D4D4">&gt;();</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">solver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">()-&gt;</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Remember to <code>#include &lt;memory&gt;</code>, as done on line 3, so we can access smart pointers. We are now declaring a <em>unique</em> pointer on line 23, which is of type <code>Solver</code>, and initially, we set it to a <code>nullptr</code>. Then we check again which solver we want to use, i.e., <code>SIMPLE</code> or <code>PISO</code>, and we make calls to <code>std::make_unique</code> accordingly. We pass the class we want to use, e.g., <code>SIMPLE</code> or <code>PISO</code>, as the template parameter and have a constructor without any arguments. If our SIMPLE or PISO class expected any constructor arguments, we would need to include them on lines 26 or 28, respectively, within the <code>()</code> brackets.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We can then use our smart pointer as shown on line 30, i.e., we first call the <code>get()</code> function on the smart pointer, which will return the raw pointer for us. Then, we can do whatever we want with our pointer and call functions that are defined in either the <code>SIMPLE</code> or <code>PISO</code> class. Since we declared the <code>solve()</code> function as a pure virtual function in the abstract base class <code>Solver</code>, we are guaranteed that any class deriving from this class will have a corresponding implementation of the <code>solve()</code> class, so this call will always succeed, regardless of which class we are calling.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-smart-pointers-and-the-factory-pattern-for-clean-code">Introducing the factory pattern with smart pointers</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Let's tidy up this example by putting the creation of the solver into its own function. We'll skip the header include statements, as well as the class definitions for the <code>Solver</code>, <code>SIMPLE</code>, and <code>PISO</code> class, but these would still need to be present if you want to compile the following example:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"std::unique_ptr\u0026lt;Solver\u003e makeSolver(std::string name) {\n  std::unique_ptr\u0026lt;Solver\u003e solver = nullptr;\n  if (name == \u0022SIMPLE\u0022) {\n    solver = std::make_unique\u0026lt;SIMPLE\u003e();\n  } else if (name == \u0022PISO\u0022) {\n    solver = std::make_unique\u0026lt;PISO\u003e();\n  }\n  return solver;\n}\n\nint main()\n{\n  std::string name(\u0022SIMPLE\u0022);\n\n  auto solver = makeSolver(name);\n\n  solver.get()-\u003esolve();\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eunique_ptr\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emakeSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estring\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ename\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::unique_ptr\u0026lt;Solver\u0026gt; solver = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enullptr\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_unique\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSIMPLE\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eelse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (name == \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;PISO\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    solver = \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emake_unique\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003ePISO\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt;();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e solver;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::string \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ename\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;SIMPLE\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e solver = \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emakeSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(name);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003esolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eget\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e()-\u0026gt;\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":19,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="std::unique_ptr&lt;Solver&gt; makeSolver(std::string name) {
  std::unique_ptr&lt;Solver&gt; solver = nullptr;
  if (name == &quot;SIMPLE&quot;) {
    solver = std::make_unique&lt;SIMPLE&gt;();
  } else if (name == &quot;PISO&quot;) {
    solver = std::make_unique&lt;PISO&gt;();
  }
  return solver;
}

int main()
{
  std::string name(&quot;SIMPLE&quot;);

  auto solver = makeSolver(name);

  solver.get()-&gt;solve();
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">unique_ptr</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">Solver</span><span style="color: #D4D4D4">&gt; </span><span style="color: #DCDCAA">makeSolver</span><span style="color: #D4D4D4">(</span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">name</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::unique_ptr&lt;Solver&gt; solver = </span><span style="color: #569CD6">nullptr</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_unique</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">SIMPLE</span><span style="color: #D4D4D4">&gt;();</span></span>
<span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (name == </span><span style="color: #CE9178">&quot;PISO&quot;</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    solver = </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">make_unique</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">PISO</span><span style="color: #D4D4D4">&gt;();</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> solver;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">()</span></span>
<span class="line"><span style="color: #D4D4D4">{</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::string </span><span style="color: #DCDCAA">name</span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">&quot;SIMPLE&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> solver = </span><span style="color: #DCDCAA">makeSolver</span><span style="color: #D4D4D4">(name);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">solver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">()-&gt;</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">();</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>There are a few interesting things happening here, which are worth to explore. We define a function <code>makeSolver()</code> on line 1, which expects one argument of type <code>std::string</code>, which tells us which solver to create. We then go through the same logic as before. However, on line 8, we return the <code>unique</code> pointer from our function, and, on line 1, we define the return type as std::unique_ptr, i.e. this is copy by value, not copy by reference. You may not see the importance of this, but we stated before that <code>unique</code> pointers can't be copied, yet this is what this function is doing, and the worst (or best?) part about it is that it works. The compiler doesn't complain. The reason here is that the compiler wants to be <em>smart</em>, and whenever we return values from a function where a copy can be avoided, the compiler will try to do exactly that.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In our case, there is nothing stopping the compiler from returning the <em>unique</em> pointer by reference, and so this is what the compiler is doing for us, and we don't get an error message during compilation. This is known as <a href="https://en.wikipedia.org/wiki/Copy_elision" target="_blank" rel="noopener" title="">copy elision</a>. Something similar happens when you use a data structure like <code>std::vector</code>. You may allocate a bunch of memory on the heap, and instead of copying that data around when you just want to return from a function, your compiler will automatically return by reference and leave the memory where it is. This is known as <a href="https://stackoverflow.com/questions/12953127/what-are-copy-elision-and-return-value-optimization" target="_blank" rel="noopener" title="">return value optimization</a>, or RVO in short, and both copy elision and RVO are closely connected. You may come across either term in the literature, suffice it to say that these are mechanisms your compiler is employing to make your code more performant. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We can prevent the compiler from being clever by declaring variables as <code>volatile</code>. This will indicate to the compiler that you don't want it to optimise anything about this variable and leave everything exactly as it is. So, if you change line 2 to read<br><code>volatile std::unique_ptr solver = nullptr;</code>, then your compiler keeps the copy by value as the return value, it will not perform <em>copy elision</em>, and you will be hit with a myriad of error messages, all essentially saying that you can't copy a <code>unique</code> pointer. Give it a try and enjoy the onslaught of error messages, this is the best way to get intimately familiar with your compiler of choice!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>To finish off the example, on line 15 in the code above, we call the function <code>makeSolver()</code> and pass the <code>std::string</code> as the argument to the function. Now we can add as many different solvers to the <code>makeSolver()</code> function, but our code in the <code>main()</code> function would not change. This is an important programming design pattern and is known as the <a href="https://refactoring.guru/design-patterns/factory-method" target="_blank" rel="noopener" title="">factory pattern</a>. Here, the <code>makeSolver()</code> function acts as our factory which produces different versions of <code>Solver</code> instances based on some input (here, simply the name of the solver). In real code, you may see function names containing the word <em>factory</em> itself, e.g. we could have also called our function <code>solverFactory()</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Factories are very useful to add functionality to your code dynamically. They are part of a much wider range of <a href="https://refactoring.guru/design-patterns/catalog" target="_blank" rel="noopener" title="">design patterns</a>, which eventually we have to learn if we really want to write clean code. We'll leave that to another day, as you will see that there are over 20 different design patterns if you click on the link above. We don't necessarily use all of them at the same time, but knowing them and then knowing when to use them will boost your code structure significantly.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We already saw how we can simply create different instances of pressure velocity coupling algorithms using a factory pattern; other places where you may want to use are listed below to give you some idea:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Turbulence models</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Transport models for non-Newtonian fluids</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Descretisation schemes in space</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Time-integration schemes</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>You get the idea; for each of these types, you may want to have several options available and then use a factory pattern in conjunction with a <em>smart pointer</em> to generate the variables.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-not-so-smart-smart-pointers-in-openfoam">Not so-smart smart pointers in OpenFOAM</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We don't have to look far for an example in real life; OpenFOAM makes use of exactly this principle, albeit a bit more convoluted. Whenever you create a new solver, there is a file called <code>createFields.H</code>, which essentially constructs all of your field vectors and scalars, such as velocity and pressure. It also handles the turbulence model setup if the particular solver does support turbulence modelling. Many solver support turbulence modelling, like the <a href="https://develop.openfoam.com/Development/openfoam/-/blob/OpenFOAM-v2306/applications/solvers/incompressible/simpleFoam/createFields.H?ref_type=tags" target="_blank" rel="noopener" title="">simpleFoam</a> solver, and if we look at its <code>createFields.H</code> file, you'll see code like the following at the bottom of the file:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"autoPtr\u0026lt;incompressible::turbulenceModel\u003e turbulence\n(\n    incompressible::turbulenceModel::New(U, phi, laminarTransport)\n);","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003eautoPtr\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eincompressible\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::turbulenceModel\u0026gt; turbulence\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eincompressible\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eturbulenceModel\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eNew\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(U, phi, laminarTransport)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","seeMoreType":"","seeMoreString":"","seeMoreTransition":false,"highestLineNumber":4,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="autoPtr&lt;incompressible::turbulenceModel&gt; turbulence
(
    incompressible::turbulenceModel::New(U, phi, laminarTransport)
);" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">autoPtr&lt;</span><span style="color: #4EC9B0">incompressible</span><span style="color: #D4D4D4">::turbulenceModel&gt; turbulence</span></span>
<span class="line"><span style="color: #D4D4D4">(</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #4EC9B0">incompressible</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">turbulenceModel</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">New</span><span style="color: #D4D4D4">(U, phi, laminarTransport)</span></span>
<span class="line"><span style="color: #D4D4D4">);</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Here, we use an <code>autoPtr</code>, which was the first attempt of C++ to introduce smart pointers. An <code>autoPtr</code> is very similar to what we now have as a <code>unique</code> pointer. There were some issues with auto pointers, and so they have been deprecated with the C++11 standard, which was released in 2011. So there is no need to understand what an auto pointer, but the reason OpenFOAM uses them is because it was created way before 2011, and so no smart pointers were available. I guess replacing the deprecated <code>autoPtr</code> has not made it to the top of the priority list yet.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Returning to the above-shown code, we create essentially a <em>smart pointer</em> and pass the <code>New</code> function to the constructor call. This function will then figure out which turbulence model should be used (similar to the above example with if/else statements, but this is the part where things get a bit more complicated, so we won't dig much deeper into the code here). But similar to the above factory pattern that we introduced, we can now add as many turbulence models as we want and then use them later in the code. Our code shown above would not change in terms of creating a turbulence model.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-summary">Summary</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This concludes our discussion on smart pointers. They are essentially just normal raw pointers, with additional <a href="https://en.wikibooks.org/wiki/Haskell/Syntactic_sugar" target="_blank" rel="noopener" title="">syntactic sugar</a> to make our life a bit easier. They also handle memory allocation and deallocation for us, so we should be able to reduce memory bugs automatically by switching from raw to smart pointers. Hopefully, you will agree that smart pointers are incredibly useful and that you will make an effort to use them from now on if you are not doing so already.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In this article, we also touched upon the concept of copy elision and return value optimisation (RVO), which are not necessarily only relevant when using smart pointers, but in general when we are dealing with memory and we want to reduce unnecessary copies of large amount of data. Furthermore, we looked at the factory design pattern and how it can be used, together with smart pointers, to promote clean code design.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you are already using raw pointers (are you a C programmer, pretending to code in C++ by using a C++ compiler on C code?), then switching to smart pointers should be straightforward, the syntax to create them is slightly different, but then you get all the benefit of having someone else looking after your memory allocation and deallocation. Use smart pointers, and thank me later!</p>
<!-- /wp:paragraph -->