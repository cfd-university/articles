<!-- wp:paragraph -->
<p>In this article, we will first look at why sparse matrices, as found in CFD applications, really need to be stored with an adequate sparse matrix storage format, by looking at some back of the envelop calculations that show that we can save a significant amount of data by using an appropriate storage format. We then proceed to look at how we would implement the compressed sparse row (CSR) storage format into a matrix class which we will use to store our coefficient matrix of the 1D head diffusion equation.</p>
<!-- /wp:paragraph -->

<!-- wp:block {"ref":2490} /-->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong>Download</strong>: <a href="https://cfd.university/download/linearalgebralib-part-6-the-sparse-matrix-class/?tmstv=1712896293" title="">linearAlgebraLib-Part-6-The-sparse-matrix-class.zip</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this series</h2>
<!-- /wp:heading -->

<!-- wp:shortcode -->
[custom_category_posts_list category_slug="how-to-compile-write-and-use-cfd-libraries-in-c"]
<!-- /wp:shortcode -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this article</h2>
<!-- /wp:heading -->

<!-- wp:aioseo/table-of-contents {"headings":[{"id":7,"blockClientId":"d42e292c-99d5-47ba-aacb-1a4fa7ebc085","content":"How we got here","level":2,"anchor":"aioseo-how-we-got-here","order":0,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":10,"blockClientId":"6f690ea1-2cef-40c7-96f3-7edd66cfc35c","content":"Sparse vs Dense matrices","level":2,"anchor":"aioseo-sparse-matrices","order":1,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":14,"blockClientId":"7e3730d1-ddc4-4501-b1c0-3c7c3cfa4ae7","content":"Sparse matrices in CFD applications","level":3,"anchor":"aioseo-sparse-matrices-in-cfd-applications","order":2,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":18,"blockClientId":"2ddd3664-7e72-465d-927e-e103299c07b1","content":"Sparse matrices for structured grids","level":4,"anchor":"aioseo-sparse-matrix-structures-for-structured-grids","order":3,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":28,"blockClientId":"024318d2-22b0-4ac1-8879-3124e5294e70","content":"Sparse matrices for unstructured grids","level":4,"anchor":"aioseo-spare-matrices-for-usntructured-grids","order":4,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":34,"blockClientId":"d14afc00-d389-46e8-8e9c-ef4e3e86105c","content":"The cost of dense matrices and how sparse matrices save the day","level":3,"anchor":"aioseo-the-cost-of-dense-matrices-and-how-sparse-matrices-are-here-to-save-our-day","order":5,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":46,"blockClientId":"3844bfb0-94c2-4472-9ed5-14fad5fa60d7","content":"Storing sparse matrices efficiently","level":2,"anchor":"aioseo-storing-sparse-matrices-efficiently","order":6,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":48,"blockClientId":"387b1495-97bc-42b6-b5f8-bdf1972d3786","content":"The coordinate matrix","level":3,"anchor":"aioseo-the-coordinate","order":7,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":52,"blockClientId":"3bbaedd1-ec01-4290-89be-9dd9db92758b","content":"The compressed sparse row (CSR) matrix","level":3,"anchor":"aioseo-the-compressed-row-storage-csr","order":8,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":63,"blockClientId":"bc53cb4b-f772-4133-ac5c-842d7ca0b602","content":"Matrix class interface","level":2,"anchor":"aioseo-the-matrix-class","order":9,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":70,"blockClientId":"87af506a-cc5b-46db-ae05-732e3ce2cd3f","content":"Matrix class implementation","level":2,"anchor":"aioseo-matrix-class-implementation","order":10,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":74,"blockClientId":"5c162cb8-1ed2-41af-ab9b-e835c96ee56b","content":"Required class utility functions","level":3,"anchor":"aioseo-required-class-utility-functions","order":11,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":86,"blockClientId":"ac39fad6-3243-47fd-9c00-07989a98ba04","content":"Getters and setters","level":3,"anchor":"aioseo-getters-and-setters","order":12,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":96,"blockClientId":"b9362e48-c54c-4fb3-8b98-a66a09434262","content":"Arithmetic overloaded operators","level":3,"anchor":"aioseo-arithmetic","order":13,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":98,"blockClientId":"d6f81c37-4a48-4f60-bd12-06b7dbe9c5c3","content":"Scalar-Matrix multiplication","level":4,"anchor":"aioseo-scalar-matrix-multiplication","order":14,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":101,"blockClientId":"e8145f09-5b63-4226-a998-0d8f64058bb8","content":"Matrix-Vector multiplication","level":4,"anchor":"aioseo-matrix-vector-multiplication","order":15,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]}]},{"id":108,"blockClientId":"eb9f8b1f-e2a3-4866-a69b-353d994e8817","content":"Summary","level":2,"anchor":"aioseo-summary","order":16,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]} -->
<div class="wp-block-aioseo-table-of-contents"><ul><li><a href="#aioseo-how-we-got-here">How we got here</a></li><li><a href="#aioseo-sparse-matrices">Sparse vs Dense matrices</a><ul><li><a href="#aioseo-sparse-matrices-in-cfd-applications">Sparse matrices in CFD applications</a><ul><li><a href="#aioseo-sparse-matrix-structures-for-structured-grids">Sparse matrices for structured grids</a></li><li><a href="#aioseo-spare-matrices-for-usntructured-grids">Sparse matrices for unstructured grids</a></li></ul></li><li><a href="#aioseo-the-cost-of-dense-matrices-and-how-sparse-matrices-are-here-to-save-our-day">The cost of dense matrices and how sparse matrices save the day</a></li></ul></li><li><a href="#aioseo-storing-sparse-matrices-efficiently">Storing sparse matrices efficiently</a><ul><li><a href="#aioseo-the-coordinate">The coordinate matrix</a></li><li><a href="#aioseo-the-compressed-row-storage-csr">The compressed sparse row (CSR) matrix</a></li></ul></li><li><a href="#aioseo-the-matrix-class">Matrix class interface</a></li><li><a href="#aioseo-matrix-class-implementation">Matrix class implementation</a><ul><li><a href="#aioseo-required-class-utility-functions">Required class utility functions</a></li><li><a href="#aioseo-getters-and-setters">Getters and setters</a></li><li><a href="#aioseo-arithmetic">Arithmetic overloaded operators</a><ul><li><a href="#aioseo-scalar-matrix-multiplication">Scalar-Matrix multiplication</a></li><li><a href="#aioseo-matrix-vector-multiplication">Matrix-Vector multiplication</a></li></ul></li></ul></li><li><a href="#aioseo-summary">Summary</a></li></ul></div>
<!-- /wp:aioseo/table-of-contents -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-how-we-got-here">How we got here</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>In the previous two articles, we looked first at <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-the-conjugate-gradient-class" target="_blank" rel="noopener" title="">how to implement the Conjugate Gradient algorithm</a>, which prompted the necessity of having both a vector and matrix class. We looked at the <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-the-vector-class" target="_blank" rel="noopener" title="">vector class in the previous article</a> and in this week's article, we'll look at the matrix class, finally. As a reminder, the basic structure of our library is given below with its 4 header and source files, which we described in depth in our <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-basic-library-structure" target="_blank" rel="noopener" title="">basic library structure</a> article. </p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"root\n├── build\n├── linearAlgebraLib\n│   ├── linearAlgebraLib.hpp\n│   └── src\n│       ├── vector.(hpp|cpp)                   // previous article\n│       ├── sparseMatrixCSR.(hpp|cpp)          // current article\n│       ├── linearAlgebraSolverBase.(hpp|cpp)  // 2nd previous article\n│       └── conjugateGradient.(hpp|cpp)        // 2nd previous article\n├── main.cpp\n└── buildAndRun.(sh|bat)","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003eroot\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── build\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   ├── \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ehpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   └── src\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── vector.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e                   // previous article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── sparseMatrixCSR.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e          // current article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── linearAlgebraSolverBase.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // 2nd previous article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       └── conjugateGradient.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e        // 2nd previous article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e└── buildAndRun.(sh|bat)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":11,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="root
├── build
├── linearAlgebraLib
│   ├── linearAlgebraLib.hpp
│   └── src
│       ├── vector.(hpp|cpp)                   // previous article
│       ├── sparseMatrixCSR.(hpp|cpp)          // current article
│       ├── linearAlgebraSolverBase.(hpp|cpp)  // 2nd previous article
│       └── conjugateGradient.(hpp|cpp)        // 2nd previous article
├── main.cpp
└── buildAndRun.(sh|bat)" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">root</span></span>
<span class="line"><span style="color: #D4D4D4">├── build</span></span>
<span class="line"><span style="color: #D4D4D4">├── linearAlgebraLib</span></span>
<span class="line"><span style="color: #D4D4D4">│   ├── </span><span style="color: #9CDCFE">linearAlgebraLib</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">hpp</span></span>
<span class="line"><span style="color: #D4D4D4">│   └── src</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── vector.(hpp|cpp)</span><span style="color: #6A9955">                   // previous article</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── sparseMatrixCSR.(hpp|cpp)</span><span style="color: #6A9955">          // current article</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── linearAlgebraSolverBase.(hpp|cpp)</span><span style="color: #6A9955">  // 2nd previous article</span></span>
<span class="line"><span style="color: #D4D4D4">│       └── conjugateGradient.(hpp|cpp)</span><span style="color: #6A9955">        // 2nd previous article</span></span>
<span class="line"><span style="color: #D4D4D4">├── </span><span style="color: #9CDCFE">main</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cpp</span></span>
<span class="line"><span style="color: #D4D4D4">└── buildAndRun.(sh|bat)</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-sparse-matrices">Sparse vs Dense matrices</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Before we dive deep into the implementation of our matrix class, I want to spend some time first describing how we store our matrix, and why. For this, we need to first recap the differences between a dense and a sparse matrix. In the following, I have taken images from <a href="https://matteding.github.io/2019/04/25/sparse-matrices/" target="_blank" rel="noopener" title="">Matt Eding's article on Sparse Matrices</a>, which in itself is a brilliant read and highly recommended. It goes beyond what we need but shows different ways to store matrices. We'll only look at what is the commonly accepted practice in the CFD community, but this may be a good article for background reading.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The picture below depicts a sparse and dense matrix. The difference is that a dense matrix stores all its elements, regardless of their value, whereas a sparse matrix recognises that there are elements which are zero and do not need to be stored. This saves memory and ultimately computational resources. CFD applications always produce sparse matrices and so we need a mechanism to store them efficiently. The figure below shows empty spots in the sparse matrix we don't want to store, while these zero elements are stored for the dense matrix. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2155,"width":"600px","sizeSlug":"large","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-large is-resized"><img src="https://cfd.university/wp-content/uploads/2023/11/sparse_vs_dense-1024x512.gif" alt="" class="wp-image-2155" style="width:600px"/><figcaption class="wp-element-caption">Source: <a href="https://matteding.github.io/2019/04/25/sparse-matrices/" title="">Sparse Matrices</a></figcaption></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-sparse-matrices-in-cfd-applications">Sparse matrices in CFD applications</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Let's look at some typical matrix patterns in CFD applications. When we discretised the 1D heat diffusion equation, we ended up with the linear system of equations [katex]\mathbf{Ax}=\mathbf{b}[/katex]. We saw that the matrix [katex]\mathbf{A}[/katex] here contained all the coefficients from the discretised equation, and this implicitly stores the information about which equation is solved, as well as which numerical schemes are used to solve this equation. We also looked at the structure of that matrix, which is repeated below for convenience</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>\begin{bmatrix}a_0 &amp; a_1 &amp; &amp; &amp; \dots &amp; \\ a_0 &amp; a_1 &amp; a_2 &amp; &amp; &amp; \vdots \\ &amp; a_1 &amp;a_2 &amp; a_3 &amp; &amp; \\ &amp; &amp; &amp; \ddots &amp; &amp;\\ \vdots &amp; &amp; &amp; a_{k-2} &amp; a_{k-1} &amp; a_{k} \\ 0 &amp; \dots &amp;  &amp; &amp; a_{k-1} &amp; a_{k} \end{bmatrix} \begin{bmatrix}x_0 \\ x_1 \\ x_2 \\ \vdots \\ x_{k-1} \\ x_{k}\end{bmatrix} = \begin{bmatrix}b_0 \\ b_1 \\ b_2 \\ \vdots \\ b_{k-1} \\ b_{k}\end{bmatrix}</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>This matrix only stores elements on the diagonal and then to its immediate left and right neighbours. That is, if we are on row [katex]i[/katex], we only store elements at column [katex]i-1[/katex] and [katex]i+1[/katex]. All other entries that are at [katex]i\pm 2[/katex] or above/below, are zero.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading" id="aioseo-sparse-matrix-structures-for-structured-grids">Sparse matrices for structured grids</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Let's look at a structured, 2D grid, and how the matrix would look in this case. Below is an example of a 4 by 4 2D mesh, and we are focusing on cells 6 and 16 here. We show its direct neighbours, and then how the matrix structure would look like. We use colours to highlight where in the matrix each element is stored.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2164,"width":"900px","sizeSlug":"large","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-large is-resized"><img src="https://cfd.university/wp-content/uploads/2023/11/2d_structured_grid-1024x490.png" alt="" class="wp-image-2164" style="width:900px"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>For each cell, we store the neighbours of cell [katex]i[/katex] in row [katex]i[/katex], and we use the [katex]j[/katex] index to identify neighbouring cells. If we go back to our <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-discretising-the-model-equation" target="_blank" rel="noopener" title="">article on discretising the 1D heat diffusion equation</a>, we see that we ended up with the following equation</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>T_{E}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)+T_P^{n+1}\left(\frac{-2\Gamma A}{\Delta x}\right)+T_{W}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)=0</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>We can use this equation and rewrite it to make sense for our matrix structure given above. Since we only have a 1D problem, we'll only have direct neighbours to the left and right of the main diagonal. In [katex]i, j[/katex] notation, the above equation would read as</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>T_{i,j+1}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)+T_{i,j}^{n+1}\left(\frac{-2\Gamma A}{\Delta x}\right)+T_{i,j-1}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)=0</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>With this notation, we need to further set [katex]i=j[/katex], and so the main diagonal is represented b [katex]T_{i,j}[/katex]. It's neighbouring neighbours are [katex]T_{i,j-1}[/katex] and [katex]T_{i,j+1}[/katex], and all values given in parenthesis are the actual values we store in the coefficient matrix at locations [katex]i,j-1[/katex], [katex]i,j[/katex], and [katex]i,j+1[/katex].</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Returning back to the above figure and focusing on cells 6 and 16 (orange), that means we have to go to row 6 or 16 in our coefficient matrix. Cell 6 is stored at [katex]i=6, j=6[/katex] and so we always have a main diagonal in a sparse matrix for CFD applications. The neighbours to the left and right are in cells 5 and 7, and thus, still on row [katex]i=6[/katex], we also have entries at [katex]i=6, j=5[/katex] and [katex]i=6, j=7[/katex], shown in blue. We end up with an additional diagonal band to the left and right due to neighbours above and below cell 6. Here, we also have neighbours in the form of cells 2 and 10, and thus have additional entries at [katex]i=6, j=2[/katex] and [katex]i=6, j=10[/katex].</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>For cell 16, the situation is similar, but we focus here on a cell which sits on the boundary. Cell 16's neighbours are again found on row 16 in the coefficient matrix, and we see that only cell 12 and 15, stored at locations [katex]i=16, j=12[/katex] and [katex]i=16, j=15[/katex], are present in the coefficient matrix. Structured grids always have this banded structure.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading" id="aioseo-spare-matrices-for-usntructured-grids">Sparse matrices for unstructured grids</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Unstructured grids, on the other hand, have no clear ordering of neighbours so their sparse matrices look somewhat random. Below is an image that shows typical matrix structures for structured and unstructured matrices, to compare their form. Here, we simply visualise all elements that have a non-zero value with a blue dot and zero values are not shown. This allows us to see the sparse matrix structure.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2158,"sizeSlug":"full","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-full"><img src="https://cfd.university/wp-content/uploads/2023/11/matrix_comaprison.png" alt="" class="wp-image-2158"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We already saw the structured grid example above, but can summarise here that if we had more elements in our stencil, or had a 3D mesh which contained more neighbours, we would end up with simply more bands to the left and right of the main diagonal. The unstructured grid still has a main diagonal as we always have elements at [katex]i=j[/katex], i.e. when we loop over our mesh, this is the cell for which we are computing the solution and all other cells are just neighbours of this cell. However, the randomness in locations presents two issues for us if we were to store the matrix in this form:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>We incur a lot of cache misses if we store the matrix in its random structure (see also my article on <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/understanding-memory-management-in-c" target="_blank" rel="noopener" title="">memory management in C++</a> which explores the role of memory in more depth and why efficient memory management is mandatory for CFD applications)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>We increase the number of communications for inter-processor boundary exchanges if we want to <a href="https://www.techtarget.com/searchenterprisedesktop/definition/message-passing-interface-MPI" target="_blank" rel="noopener" title="">parallelise our code with MPI</a> (Messenger Passing Interface).</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Thus, we would like to get back to this banded structure we have with structured grids, so we typically reorder our unstructured grid for efficiency. This is shown on the right on the plot above, i.e. the middle and right matrix are the same matrix, the right one is just a reordered version of the middle matrix. Here, I used the reverse <a href="https://en.wikipedia.org/wiki/Cuthill%E2%80%93McKee_algorithm" target="_blank" rel="noopener" title="">Cuthill-McKee algorithm</a>, which is the standard matrix reordering algorithm in all CFD applications.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-the-cost-of-dense-matrices-and-how-sparse-matrices-are-here-to-save-our-day">The cost of dense matrices and how sparse matrices save the day</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Now that we have some understanding of the structure of sparse matrices, let's get a feeling for how much storage they save. We can come up with this simple equation that calculates the number of non-zero elements in our matrix</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>nonZeroElements = numberOfCellsInStencil * numberOfCells</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>The numberOfCellsInStencil variable contains the cell for which we want to compute the solution (i.e. the element on the main diagonal) and all its neighbours. In 1D, we always have 2 neighbours so our stencil size is 3 (1 central cell + 2 neighbours), unless we consider a higher-order numerical scheme which requires more than just the direct neighbours in the stencil. In our 2D structured grid example above, the numberOfCellsInStencil variable is 5, 1 central cell plus 4 neighbours, one to each side of the central cell's faces. In 3D, this would expand to 7 (6 neighbours in total for a cube, i.e. it has 6 faces and so 6 neighbours).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Unstructured grids can, on the other hand, have any number of neighbouring cells, as the cells themselves can be anything from a triangle in 2D (3 faces, thus 3 neighbours), to an infinitely large polyhedra in 3D. Commonly, polyhedra cells can have 12 faces which serves as a good approximate average value. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>With that in mind, we can define the sparsity of a matrix as</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>sparsity=1-\frac{nonZeroElements}{numberOfCells^2}</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>Let's do this for a couple of examples. Let's assume we want to solve a problem on a mesh with 1 million elements. Let's consider 1D, 2D, and 3D grids, with line (1D), triangle (2D), hexahedron (3D) and polyhedron (3D) cell types. Each cell type will have a different number of elements in their stencel, namely: line (2 neighbours), triangle (3 neighbours), hexahedron (6 neighbours) and polyhedron (12 neighbours). Furthermore, we assume that we want to store double-precision values of type <code>double</code>, each being 8 byte in size. Thus, if we wanted to store this coefficient matrix as a dense matrix, we would have to store 1 million * 1 million values of 8 bytes, <strong>resulting in storage requirements of 8 Terabytes for the coefficient matrix alone</strong>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We can't handle that much memory, as we are always limited by the amount of memory in our random access memory (RAM) poll. Our applications always get loaded into RAM before execution, and the last time I checked, RAM was still measured in Gigabytes, not Terabytes. And even if we had TeraBytes of memory available, we are only talking about a 1 million cell mesh here, this is still rather small. So, we need something better, let's calculate the storage requirement then for the above-mentioned cells and see how sparse matrices can help us save the day.</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>1D structured, line elements, numberOfCellsInStencil = 3: nonZeroElements = 3 million, sparsity = 99.9997%, <strong>Storage = 24 MegaBytes</strong></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>2D unstructured, triangle, numberOfCellsInStencil = 4, nonZeroElements = 4 million, sparsity = 99.9996%, <strong>Storage = 32 MegaBytes</strong></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>3D structured, hexahedron, numberOfCellsInStencil = 6, nonZeroElements = 6 million, sparsity = 99.9994%, <strong>Storage = 48 MegaBytes</strong></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>3D unstructured, polyhedron, numberOfCellsInStencil = 12, nonZeroElements = 12 million, sparsity = 99.9988%, <strong>Storage = 96 MegaBytes</strong></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Instead of measuring memory in TeraBytes, our sparse matrices with sparsity well above 99.99% have now storage requirements that are less than 100 MegaBytes (it is actually going to be slightly larger, as we need to store additional information for such as the location of the values in the matrix, but the order of magnitude will remain the same). That easily fits into our memory. This shows that we really want to store our matrix as a sparse matrix, rather than a full, dense matrix. In the next section, we'll explore how we achieve just that.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-storing-sparse-matrices-efficiently">Storing sparse matrices efficiently</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We saw that we really want to use a sparse matrix structure to save storage. But how do we store these matrices then? Just storing the non-zero values is no good, as we have no information about where in the matrix these values are stored. So we need to come up with additional information that helps us identify where in the matrix these non-zero values are stored. We look at two examples below, one simple and one more advanced concept. As you may have already guessed, CFD always likes to favour the more complicated type, so we use the simple example to prepare us to understand the more advanced concept.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-the-coordinate">The coordinate matrix</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>The coordinate matrix is probably the simplest of all sparse matrix formats. What we do in this case is simply store the data (i.e. the non-zero elements of the matrix), along with its [katex]i,j[/katex] coordinate in the matrix. The image below demonstrates this data structure.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2154,"width":"600px","sizeSlug":"large","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-large is-resized"><img src="https://cfd.university/wp-content/uploads/2023/11/coordinate_matrix-1024x512.gif" alt="" class="wp-image-2154" style="width:600px"/><figcaption class="wp-element-caption">Source: <a href="https://matteding.github.io/2019/04/25/sparse-matrices/" target="_blank" rel="noopener" title="">Sparse Matrices</a></figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We have 5 non-zero elements, all stored in the data array. They can be in any order, i.e. we do not necessarily have to go row by row through the matrix. The corresponding row and column array stores the index in the matrix itself. So, the first data entry has a value of 2 at [katex]i=1,j=1[/katex], the second entry has a value of 5, which is stored at [katex]i=3,j=4[/katex], etc. This is a simple, yet effective way to store data. And this already gets us a huge improvement over a dense matrix. The issue here is, however, that we are storing both rows and columns explicitly. If we rearrange our data a bit, we actually only have to store the column index.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-the-compressed-row-storage-csr">The compressed sparse row (CSR) matrix</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>The compressed sparse row (CSR) matrix structure is very similar to the coordinate matrix, but we rearrange our column indices so that they go through row by row. Let's look at an example which hopefully clarifies this situation</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2152,"width":"600px","sizeSlug":"full","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><img src="http://cfd.university/wp-content/uploads/2023/11/compressed_row_storage.gif" alt="" class="wp-image-2152" style="width:600px"/><figcaption class="wp-element-caption">Source: <a href="https://matteding.github.io/2019/04/25/sparse-matrices/" target="_blank" rel="noopener" title="">Sparse Matrices</a></figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We focus only on the data array and matrix itself for now. The first row has two values; 8 and 2. The data array shows these two values appear as the first two entries as well. The next row contains only a single entry; 5. This is the next entry in the data array. We jump 2 rows and then have another row with values of 7, 1, and 2. These appear next in the data array and finally, on the last row, we have an entry of 9, which is the last entry in the data array. So we see, the entries in the data array are all separated by rows, though we do not know where a new row begins or indeed which column each entry sits in.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>For this, we use two additional arrays. First of all, the indices array stores the column location, so for example, the first two entries are 0 and 2, and these correspond to the column location of the first two entries in the data array 8 and 2 (columns 0 and 2). You can see that you can identify the column location for each entry in the data array with this indices array, so it follows that the size of the indices array must be the same as that of the data array.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>How do we know in which row the data is stored? For this, we use the index pointer array. Its first value is always 0. The next entry shows how many entries there are for the first row (or rather, how far into the data array we have to index to get to the end of the first row). So in this case, a value of 2 indicates that there are 2 elements in the first row. The next entry in the index pointer array tells us how far we have to go in the data array to get all values in the second row. In this case, the value is 3. Since the previous row stopped at index 2, we have [katex]3-2=1[/katex] entry in the second row.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The next row is more interesting, as we do not have any data here. If we look at the next entry in the index pointer array, its value is also 3, and so it has [katex]3-3=0[/katex] entries! This is the same for the next row, after which the value changes to 6, and so we have [katex]6-3=3[/katex] entries, which correspond to the values 7, 1, and 2 in our sparse matrix.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>One important detail is not given, and we have to implicitly construct that information; the current row. The current row is given by the index into the index pointer array. We said the first entry is always zero, but then the next entry at [katex]i=1[/katex] tells us where row 1 ends, [katex]i=2[/katex] tells us where row 2 ends, and so on. So the index into the row pointer array gives us the row, and to obtain all column entries, we have to look at the index pointer array at location [katex]i-1[/katex], which gives us the starting index into our indices and data array, while the index pointer array at [katex]i[/katex] tells us where to stop.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>To put this into an example, the first row [katex]i=1[/katex] starts at index pointer [katex]i-1=0[/katex] and goes to [katex]i=1[/katex]. The values in the index pointer array are 0 and 2, respectively. So, we loop over the interval of 0 to 2 in the indices array, which gives us the columns 0 and 2, and then we loop over the data array to get the actual values of 8 and 2. With this information, we can say that we have [katex]A_{0,0}=8[/katex] and [katex]A_{0,2}=2[/katex].</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Why do we make our lives so much more difficult? By storing the indices in a row-by-row fashion, we simply have to store where the row terminates, not each row index (which would always be the same as long as we are on the same row, thus storing unnecessary information). As we add more and more neighbours in our computational grid, i.e. as we have more and more entries on a given row, we save storage. From experience, we can say that this not only makes our matrices smaller than a corresponding coordinate matrix but also faster. Sparse matrices can be 2 times faster, potentially more, than coordinate matrices. Since CFD applications spend most of their time solving a linear system, i.e. [katex]\mathbf{Ax}=\mathbf{b}[/katex], we want to make sure it does so as efficiently as possible.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Thus, compressed sparse row (CSR) matrix structures are the one we prefer. For completeness, there is also a compressed sparse column (CRC) structure, but that will lead to more cache misses than the CSR format. Suffice it to say, CSR is probably the most used matrix storage format for CFD applications and this is what we will implement in our matrix class next.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-the-matrix-class">Matrix class interface</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>After this rather long, but necessary introduction to our matrix class, let's have a look at the class interface then. We'll jump straight into the code and discuss the required functions afterwards.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#pragma once\n\n#include \u0026lt;iostream\u003e\n#include \u0026lt;algorithm\u003e\n#include \u0026lt;vector\u003e\n#include \u0026lt;cassert\u003e\n\n#include \u0022linearAlgebraLib/src/vector.hpp\u0022\n\nnamespace linearAlgebraLib {\n\nclass SparseMatrixCSR {\npublic:\n  SparseMatrixCSR(unsigned rows, unsigned _columns);\n\n  void set(unsigned row, unsigned column, double value);\n  double get(unsigned row, unsigned column) const;\n\n  unsigned getNumberOfRows() const;\n  unsigned getNumberOfColumns() const;\n\n  Vector operator*(const Vector\u0026amp; rhs);\n  friend SparseMatrixCSR operator*(const double \u0026amp;scaleFactor, const SparseMatrixCSR \u0026amp;matrix);\n  friend std::ostream\u0026amp; operator\u0026lt;\u0026lt;(std::ostream \u0026amp;os, const SparseMatrixCSR \u0026amp;rhs);\n\nprivate:\n  std::vector\u0026lt;double\u003e _values;\n  std::vector\u0026lt;unsigned\u003e _columns;\n  std::vector\u0026lt;unsigned\u003e _rows;\n  unsigned _numberOfRows;\n  unsigned _numberOfColumns;\n};\n\n} // namespace linearAlgebraLib","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#pragma\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eonce\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;algorithm\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;vector\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;cassert\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/vector.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erow\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecolumn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003evalue\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eget\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erow\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecolumn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetNumberOfRows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetNumberOfColumns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator*\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efriend\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator*\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003escaleFactor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ematrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efriend\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eostream\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eostream\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eos\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eprivate:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::vector\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; _values;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::vector\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; _columns;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::vector\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; _rows;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e _numberOfRows;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e _numberOfColumns;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":34,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#pragma once

#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;vector&gt;
#include &lt;cassert&gt;

#include &quot;linearAlgebraLib/src/vector.hpp&quot;

namespace linearAlgebraLib {

class SparseMatrixCSR {
public:
  SparseMatrixCSR(unsigned rows, unsigned _columns);

  void set(unsigned row, unsigned column, double value);
  double get(unsigned row, unsigned column) const;

  unsigned getNumberOfRows() const;
  unsigned getNumberOfColumns() const;

  Vector operator*(const Vector&amp; rhs);
  friend SparseMatrixCSR operator*(const double &amp;scaleFactor, const SparseMatrixCSR &amp;matrix);
  friend std::ostream&amp; operator&lt;&lt;(std::ostream &amp;os, const SparseMatrixCSR &amp;rhs);

private:
  std::vector&lt;double&gt; _values;
  std::vector&lt;unsigned&gt; _columns;
  std::vector&lt;unsigned&gt; _rows;
  unsigned _numberOfRows;
  unsigned _numberOfColumns;
};

} // namespace linearAlgebraLib" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#pragma</span><span style="color: #569CD6"> </span><span style="color: #9CDCFE">once</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;algorithm&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;cassert&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/vector.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">SparseMatrixCSR</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">rows</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">row</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">row</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getNumberOfRows</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">getNumberOfColumns</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">operator*</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #569CD6">&amp;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">friend</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">operator*</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">scaleFactor</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">matrix</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">friend</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">ostream</span><span style="color: #569CD6">&amp;</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">operator&lt;&lt;</span><span style="color: #D4D4D4">(</span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">ostream</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">os</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">private:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::vector&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; _values;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::vector&lt;</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4">&gt; _columns;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::vector&lt;</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4">&gt; _rows;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> _numberOfRows;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> _numberOfColumns;</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>The matrix class structure is actually fairly straightforward and simplistic; we do keep it again to just about the functions we need and no more. We see the usual constructor on line 14, followed by one set and three get functions. The set function allows us to either set or insert new values into our matrix, while the get function gets a value for a given row and column. The next two getters are to query the size of the matrix and then we go into the three remaining operators we require for our Conjugate Gradient algorithm to work.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We saw in our <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-the-vector-class" target="_blank" rel="noopener" title="">last article on the vector class</a>, that we require a matrix-vector multiplication for the Conjugate Gradient algorithm, this is the function defined on line 22. We also want to be able to scale our matrix with a scaling factor, and, as we saw with our scalar-vector multiplication, we need to define this operation as a friend function if we want to have the order of scalar-matrix multiplication, rather than matrix-scalar multiplication. We discussed this in the <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-the-vector-class" target="_blank" rel="noopener" title="">vector class article</a> in detail, so we won't dwell on this again here.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Finally, we have the <code>operator&lt;&lt;()</code> again defined on line 24, which we may not use but it helps us print the content of the matrix class.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On lines 27-31, we define a few 1D(!) data structures. To make things clearer, referring back to the image given above on the CSR storage format, the <code>_values</code> array corresponds to the Data array, the <code>_column</code> array corresponds to the Indices array, and the <code>_rows</code> array corresponds to the Index Pointers array, respectively. Let's now turn to the actual implementation.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-matrix-class-implementation">Matrix class implementation</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>First, let's define the skeleton of the sparseMatrixCSR.cpp file and then we look into each function implementation individually. The basic structure is given below</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0022linearAlgebraLib/src/sparseMatrixCSR.hpp\u0022\n\nnamespace linearAlgebraLib {\n\n// function implementations go here ...\n\n} // namespace linearAlgebraLib","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/sparseMatrixCSR.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e// function implementations go here ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":7,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;

namespace linearAlgebraLib {

// function implementations go here ...

} // namespace linearAlgebraLib" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">// function implementations go here ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>All implementations shown below will be implemented between lines 3-7.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-required-class-utility-functions">Required class utility functions</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>The constructor of the class takes the size of the matrix, essentially, and stores that into two private variables.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"SparseMatrixCSR::SparseMatrixCSR(unsigned rows, unsigned columns) : _numberOfRows(rows), _numberOfColumns(columns) {\n  _rows.resize(_numberOfRows + 1, 0.0);\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e rows, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e columns) : \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e_numberOfRows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(rows), \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e_numberOfColumns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(columns) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eresize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(_numberOfRows + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":3,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="SparseMatrixCSR::SparseMatrixCSR(unsigned rows, unsigned columns) : _numberOfRows(rows), _numberOfColumns(columns) {
  _rows.resize(_numberOfRows + 1, 0.0);
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">SparseMatrixCSR</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> rows, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> columns) : </span><span style="color: #DCDCAA">_numberOfRows</span><span style="color: #D4D4D4">(rows), </span><span style="color: #DCDCAA">_numberOfColumns</span><span style="color: #D4D4D4">(columns) {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">resize</span><span style="color: #D4D4D4">(_numberOfRows + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>On line 2, we make use of the fact that the <code>_rows</code> (or Index Pointers, as named above in the CSR storage section) array will always start with 0 and then have <code>_numberOfRows</code> entries, so we can already resize this array to the correct size. For the <code>_data</code> and <code>_column</code> array, we can't know this size in advance.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Next, we have the getters for the size of the matrix and we can query that with the <code>getNumberOfColumns()</code> or <code>getNumberOfRows()</code> functions as shown below.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"unsigned SparseMatrixCSR::getNumberOfRows() const {\n  return _numberOfRows;\n}\n\nunsigned SparseMatrixCSR::getNumberOfColumns() const {\n  return _numberOfColumns;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetNumberOfRows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e _numberOfRows;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetNumberOfColumns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e _numberOfColumns;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":7,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="unsigned SparseMatrixCSR::getNumberOfRows() const {
  return _numberOfRows;
}

unsigned SparseMatrixCSR::getNumberOfColumns() const {
  return _numberOfColumns;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">getNumberOfRows</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> _numberOfRows;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">getNumberOfColumns</span><span style="color: #D4D4D4">() </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> _numberOfColumns;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>The final function I want to look at and classify as a utility function is the <code>operator&lt;&lt;()</code> and the code is given below.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"std::ostream\u0026amp; operator\u0026lt;\u0026lt;(std::ostream \u0026amp;os, const SparseMatrixCSR \u0026amp;rhs) {\n  os \u0026lt;\u0026lt; \u0022_Values: \u0022;\n  for (unsigned i = 0; i \u0026lt; rhs._values.size(); i++) {\n    os \u0026lt;\u0026lt; rhs._values[i] \u0026lt;\u0026lt; \u0022 \u0022;\n  }\n  os \u0026lt;\u0026lt; std::endl;\n\n  os \u0026lt;\u0026lt; \u0022Columns: \u0022;\n  for (unsigned i = 0; i \u0026lt; rhs._values.size(); i++) {\n    os \u0026lt;\u0026lt; rhs._columns[i] \u0026lt;\u0026lt; \u0022 \u0022;\n  }\n  os \u0026lt;\u0026lt; std::endl;\n\n  os \u0026lt;\u0026lt; \u0022Row Pointers: \u0022;\n  for (unsigned i = 0; i \u0026lt;= rhs._numberOfRows; i++) {\n    os \u0026lt;\u0026lt; rhs._rows[i] \u0026lt;\u0026lt; \u0022 \u0022;\n  }\n  os \u0026lt;\u0026lt; std::endl;\n\n  std::vector\u0026lt;double\u003e printVector(rhs._numberOfColumns);\n  for (unsigned currentRow = 0; currentRow \u0026lt; rhs._numberOfRows; ++currentRow) {\n    std::fill(printVector.begin(), printVector.end(), 0.0);\n    for (unsigned columnIndex = rhs._rows[currentRow]; columnIndex \u0026lt; rhs._rows[currentRow + 1]; ++columnIndex) {\n      auto currentColumn = rhs._columns[columnIndex];\n      printVector[currentColumn] = rhs._values[columnIndex];\n    }\n    for (const auto \u0026amp;value : printVector)\n      os \u0026lt;\u0026lt; value \u0026lt;\u0026lt; \u0022 \u0022;\n    os \u0026lt;\u0026lt; std::endl;\n  }\n  return os;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eostream\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eostream\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eos\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;_Values: \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(); i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot; \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Columns: \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(); i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot; \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Row Pointers: \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt;= \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_numberOfRows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot; \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::vector\u0026lt;\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e\u0026gt; \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eprintVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_numberOfColumns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e currentRow = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; currentRow \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_numberOfRows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; ++currentRow) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003efill\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eprintVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ebegin\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(), \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eprintVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eend\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(), \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e columnIndex = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[currentRow]; columnIndex \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[currentRow + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e]; ++columnIndex) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e currentColumn = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[columnIndex];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eprintVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[currentColumn] = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[columnIndex];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u0026amp;value : printVector)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      os \u0026lt;\u0026lt; value \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot; \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    os \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e os;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":32,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="std::ostream&amp; operator&lt;&lt;(std::ostream &amp;os, const SparseMatrixCSR &amp;rhs) {
  os &lt;&lt; &quot;_Values: &quot;;
  for (unsigned i = 0; i &lt; rhs._values.size(); i++) {
    os &lt;&lt; rhs._values[i] &lt;&lt; &quot; &quot;;
  }
  os &lt;&lt; std::endl;

  os &lt;&lt; &quot;Columns: &quot;;
  for (unsigned i = 0; i &lt; rhs._values.size(); i++) {
    os &lt;&lt; rhs._columns[i] &lt;&lt; &quot; &quot;;
  }
  os &lt;&lt; std::endl;

  os &lt;&lt; &quot;Row Pointers: &quot;;
  for (unsigned i = 0; i &lt;= rhs._numberOfRows; i++) {
    os &lt;&lt; rhs._rows[i] &lt;&lt; &quot; &quot;;
  }
  os &lt;&lt; std::endl;

  std::vector&lt;double&gt; printVector(rhs._numberOfColumns);
  for (unsigned currentRow = 0; currentRow &lt; rhs._numberOfRows; ++currentRow) {
    std::fill(printVector.begin(), printVector.end(), 0.0);
    for (unsigned columnIndex = rhs._rows[currentRow]; columnIndex &lt; rhs._rows[currentRow + 1]; ++columnIndex) {
      auto currentColumn = rhs._columns[columnIndex];
      printVector[currentColumn] = rhs._values[columnIndex];
    }
    for (const auto &amp;value : printVector)
      os &lt;&lt; value &lt;&lt; &quot; &quot;;
    os &lt;&lt; std::endl;
  }
  return os;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">ostream</span><span style="color: #569CD6">&amp;</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">operator&lt;&lt;</span><span style="color: #D4D4D4">(</span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #4EC9B0">ostream</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">os</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #CE9178">&quot;_Values: &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">(); i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">    os &lt;&lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[i] &lt;&lt; </span><span style="color: #CE9178">&quot; &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #CE9178">&quot;Columns: &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">(); i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">    os &lt;&lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">[i] &lt;&lt; </span><span style="color: #CE9178">&quot; &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #CE9178">&quot;Row Pointers: &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt;= </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_numberOfRows</span><span style="color: #D4D4D4">; i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">    os &lt;&lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[i] &lt;&lt; </span><span style="color: #CE9178">&quot; &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  os &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::vector&lt;</span><span style="color: #569CD6">double</span><span style="color: #D4D4D4">&gt; </span><span style="color: #DCDCAA">printVector</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_numberOfColumns</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> currentRow = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; currentRow &lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_numberOfRows</span><span style="color: #D4D4D4">; ++currentRow) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">fill</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">printVector</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">begin</span><span style="color: #D4D4D4">(), </span><span style="color: #9CDCFE">printVector</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">end</span><span style="color: #D4D4D4">(), </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> columnIndex = </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[currentRow]; columnIndex &lt; </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[currentRow + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]; ++columnIndex) {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> currentColumn = </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">[columnIndex];</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">printVector</span><span style="color: #D4D4D4">[currentColumn] = </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[columnIndex];</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> &amp;value : printVector)</span></span>
<span class="line"><span style="color: #D4D4D4">      os &lt;&lt; value &lt;&lt; </span><span style="color: #CE9178">&quot; &quot;</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">    os &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> os;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>There is quite a bit more code to go through here, but it is actually not that complicated. On lines 2-6, we simply print out the content of the <code>_values</code> array. We pretty much repeat the code on lines 8-12 for the <code>_columns</code> array. Since each non-zero entry in the matrix will have a corresponding column index in the <code>_columns</code> array, we can loop over the same length, as indicated by <code>rhs._values.size()</code> on lines 3 and 9. The argument <code>rhs</code> is passed to the function on line 1 and essentially is just the matrix class itself that we want to print.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The row pointer <code>_rows</code> is printed on lines 14-18 and apart from a differently sized array, the code for printing its content is pretty much the same as for the previous two implementations.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Lines 20-30 print the actual matrix. Before we look at the code, though, let's discuss what our goal is here: I want to print the matrix as a 2D matrix, including all zero elements so it looks like a matrix. Since we do not store the zero elements (this is the whole point of the compressed sparse row matrix storage format), we have to construct them now in a row-by-row fashion and then print each row to the console, before moving on to the next row.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>So, that is why we first have to define a <code>std::vector</code> of type <code>double</code> on line 20, which, after looping over each row on line 21, is filled with zeros using the <code>std::fill</code> standard template library algorithm. We looked at the <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/the-power-of-the-standard-template-library-stl-in-c" target="_blank" rel="noopener" title="">standard template library in-depth</a>, feel free to refresh your memory on it and then come back here. On lines 23-26, we simply loop over all column entries (line 23) and then get the value within the matrix on lines 24-25. Once we have put all non-zero elements into this temporary vector (that we call here <code>printVector</code>), we output its content on lines 27-29, and then repeat the whole process for the next row.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-getters-and-setters">Getters and setters</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>One part of object-orientated programming is that we use getters and setters to access and modify objects (classes). And we are doing exactly that here as well. First, let's look at the <code>get()</code> function, which is slightly easier to understand. It takes two arguments for the <code>row</code> and <code>column</code> and attempts to return the stored value in the matrix at that location.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"double SparseMatrixCSR::get(unsigned row, unsigned column) const {\n  assert(row \u0026lt; _numberOfRows \u0026amp;\u0026amp; column \u0026lt; _numberOfColumns \u0026amp;\u0026amp; \u0022Invalid row or column index.\u0022);\n\n  for (unsigned i = _rows[row]; i \u0026lt; _rows[row + 1]; i++) {\n    if (_columns[i] == column) {\n      return _values[i];\n    }\n  }\n\n  return 0.0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eget\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erow\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecolumn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eassert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(row \u0026lt; _numberOfRows \u0026amp;\u0026amp; column \u0026lt; _numberOfColumns \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Invalid row or column index.\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row]; i \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e]; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] == column) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":11,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="double SparseMatrixCSR::get(unsigned row, unsigned column) const {
  assert(row &lt; _numberOfRows &amp;&amp; column &lt; _numberOfColumns &amp;&amp; &quot;Invalid row or column index.&quot;);

  for (unsigned i = _rows[row]; i &lt; _rows[row + 1]; i++) {
    if (_columns[i] == column) {
      return _values[i];
    }
  }

  return 0.0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">get</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">row</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">assert</span><span style="color: #D4D4D4">(row &lt; _numberOfRows &amp;&amp; column &lt; _numberOfColumns &amp;&amp; </span><span style="color: #CE9178">&quot;Invalid row or column index.&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row]; i &lt; </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]; i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">[i] == column) {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[i];</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Similar to functions seen before, we use an assert on line 2 to make sure the right conditions are met before we continue. Then, we loop over all entries in the <code>_columns</code> vector for the given row (again, we use here the indices in the <code>_column</code> array that are between <code>_rows[row]</code> and <code>_rows[row + 1]</code> to limit the indices to only the current row that is given to the function). We check if any of the values stored in the <code>_column</code> vector match the provided column argument to the function on line 5. If it does, then we know that we have a value stored in our sparse matrix and we return that value. If we don't, then we will exit the loop and return the default value of 0 on line 10.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>set()</code> function is a bit more involved. It provides both the <code>row</code> and <code>column</code> index for which we want to set a value, as well as the <code>value</code> itself as the third argument to the function. Let's look through it step-by-step.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"void SparseMatrixCSR::set(unsigned row, unsigned column, double value) {\n  assert(row \u0026lt; _numberOfRows \u0026amp;\u0026amp; column \u0026lt; _numberOfColumns \u0026amp;\u0026amp; \u0022Invalid row or column index.\u0022);\n\n  bool rowColumnHasEntry = false;\n  unsigned index = 0;\n  for (unsigned i = _rows[row]; i \u0026lt; _rows[row + 1]; i++) {\n    if (_columns[i] == column) {\n      index = i;\n      rowColumnHasEntry = true;\n    }\n  }\n\n  if (value != 0.0) {\n    if (rowColumnHasEntry) {\n      _values[index] = value;\n    } else {\n      _values.insert(_values.begin() + _rows[row + 1], value);\n      _columns.insert(_columns.begin() + _rows[row + 1], column);\n\n      for (unsigned i = row + 1; i \u0026lt;= _numberOfRows; i++) {\n        _rows[i]++;\n      }\n    }\n  }\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erow\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecolumn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003evalue\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eassert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(row \u0026lt; _numberOfRows \u0026amp;\u0026amp; column \u0026lt; _numberOfColumns \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Invalid row or column index.\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003ebool\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e rowColumnHasEntry = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efalse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e index = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row]; i \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e]; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] == column) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      index = i;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      rowColumnHasEntry = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003etrue\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (value != \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eif\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (rowColumnHasEntry) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[index] = value;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eelse\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003einsert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ebegin\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() + \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e], value);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003einsert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ebegin\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() + \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e], column);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt;= _numberOfRows; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e        \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i]++;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":25,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="void SparseMatrixCSR::set(unsigned row, unsigned column, double value) {
  assert(row &lt; _numberOfRows &amp;&amp; column &lt; _numberOfColumns &amp;&amp; &quot;Invalid row or column index.&quot;);

  bool rowColumnHasEntry = false;
  unsigned index = 0;
  for (unsigned i = _rows[row]; i &lt; _rows[row + 1]; i++) {
    if (_columns[i] == column) {
      index = i;
      rowColumnHasEntry = true;
    }
  }

  if (value != 0.0) {
    if (rowColumnHasEntry) {
      _values[index] = value;
    } else {
      _values.insert(_values.begin() + _rows[row + 1], value);
      _columns.insert(_columns.begin() + _rows[row + 1], column);

      for (unsigned i = row + 1; i &lt;= _numberOfRows; i++) {
        _rows[i]++;
      }
    }
  }
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">row</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">column</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">value</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">assert</span><span style="color: #D4D4D4">(row &lt; _numberOfRows &amp;&amp; column &lt; _numberOfColumns &amp;&amp; </span><span style="color: #CE9178">&quot;Invalid row or column index.&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">bool</span><span style="color: #D4D4D4"> rowColumnHasEntry = </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> index = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row]; i &lt; </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]; i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">[i] == column) {</span></span>
<span class="line"><span style="color: #D4D4D4">      index = i;</span></span>
<span class="line"><span style="color: #D4D4D4">      rowColumnHasEntry = </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (value != </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (rowColumnHasEntry) {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[index] = value;</span></span>
<span class="line"><span style="color: #D4D4D4">    } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">insert</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">begin</span><span style="color: #D4D4D4">() + </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">], value);</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">insert</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">begin</span><span style="color: #D4D4D4">() + </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">], column);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">; i &lt;= _numberOfRows; i++) {</span></span>
<span class="line"><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[i]++;</span></span>
<span class="line"><span style="color: #D4D4D4">      }</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>After our usual check that the right conditions are met on line 2, we first check on lines 4-11 if we already have a value stored for a given <code>row</code>, <code>column</code> pair. If that is the case, we simply store the index in the <code>_columns</code> array and set the <code>rowColumnHasEntry</code> to <code>true</code>. We then proceed on lines 13-24, where we first check on line 13 if the value that is provided is 0. If it is, there is no point in storing this value, as we are trying to avoid storing any zeros by default.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If the value is not zero, then we have two other conditions to check. The first condition checks if we already have a value stored at the <code>row</code>, <code>column</code> pair. We checked that before, so now we can simply use the <code>rowColumnHasEntry</code> variable to check this, as we do on line 14. If we have, then we simply overwrite the value that we have already stored, and we use the index variable that we have set before, to indicate where in the <code>_values</code> array the current value is stored.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If we do not have an entry already present, then we proceed to lines 16-23. First, we insert the value and the column index at the end of the of the <code>_values</code> and <code>_columns</code> vector. The end here refers to the end of the current row, not the end of the actual vector, and thus we have to find the end of the current row with the offset <code>_values.begin() + _rows[row + 1]</code> and <code>_columns.begin() + _rows[row + 1]</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If we add values to our <code>_values</code> and <code>_columns</code> array, then we need to update our <code>_rows</code> array as well, since it stores the start and end locations of each row in these arrays. We don't have to change anything on the rows before, but we need to increase the end location by 1, as we have added 1 column to the current row. This is what we are doing on lines 20-22. We loop over row + 1, because _rows[row + 1] holds the end value for the current row. We loop until the end of the _rows vector and increase each entry by one with _rows[i]++. We could have also written this as _rows[i] = _rows[i] + 1 but I am using a shorthand notation here because C++ let us.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-arithmetic">Arithmetic overloaded operators</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Finally, let's look at the two operations we need for our matrix class, the matrix-vector and scalar-matrix multiplication.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading" id="aioseo-scalar-matrix-multiplication">Scalar-Matrix multiplication</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Since we are using a sparse storage format, multiplying our matrix with a scalar becomes incredibly simple. We simply create a copy of our current matrix, and then loop over all entries in the <code>_values</code> array and multiply them by a <code>scaleFactor</code>, which is provided to the function as an argument. We can then return this new matrix from this class. This is shown in the code below.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"SparseMatrixCSR operator*(const double \u0026amp;scaleFactor, const SparseMatrixCSR \u0026amp;matrix) {\n  SparseMatrixCSR temp = matrix;\n  for (unsigned i = 0; i \u0026lt; matrix._values.size(); ++i) {\n    temp._values[i] *= scaleFactor;\n  }\n  return temp;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator*\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003escaleFactor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ematrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  SparseMatrixCSR temp = matrix;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ematrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(); ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003etemp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] *= scaleFactor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e temp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":7,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="SparseMatrixCSR operator*(const double &amp;scaleFactor, const SparseMatrixCSR &amp;matrix) {
  SparseMatrixCSR temp = matrix;
  for (unsigned i = 0; i &lt; matrix._values.size(); ++i) {
    temp._values[i] *= scaleFactor;
  }
  return temp;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">operator*</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">scaleFactor</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">matrix</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  SparseMatrixCSR temp = matrix;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; </span><span style="color: #9CDCFE">matrix</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">(); ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">temp</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[i] *= scaleFactor;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> temp;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading" id="aioseo-matrix-vector-multiplication">Matrix-Vector multiplication</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Before we move on, let's remind ourselves how matrix-vector multiplication works. A matrix-vector operation returns a vector and can be computed in the following way:</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>\begin{bmatrix}a_1 &amp; a_2 &amp; a_3 \\ a_4 &amp; a_5 &amp; a_6 \\ a_7 &amp; a_8 &amp; a_9\end{bmatrix}\cdot \begin{bmatrix}b_1 \\ b_2 \\ b_3\end{bmatrix} = \begin{bmatrix}a_1b_1+a_2b_2+a_3b_3 \\ a_4b_1+a_5b_2+a_6b_3 \\ a_7b_1+a_8b_2+a_9b_3\end{bmatrix}</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>It is precisely of this operation that the CSR format is so popular and powerful, as we will see next in our code.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"Vector SparseMatrixCSR::operator*(const Vector\u0026amp; rhs) {\n  assert(rhs.size() == _numberOfColumns \u0026amp;\u0026amp; \u0022Vector size does not match the number of columns in the matrix.\u0022);\n\n  Vector result(_numberOfColumns);\n\n  for (unsigned row = 0; row \u0026lt; _numberOfRows; ++row) {\n    for (unsigned columnIndex = _rows[row]; columnIndex \u0026lt; _rows[row + 1]; ++columnIndex) {\n      auto column = _columns[columnIndex];\n      result[row] += _values[columnIndex] * rhs[column];\n    }\n  }\n\n  return result;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003eoperator*\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eassert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() == _numberOfColumns \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Vector size does not match the number of columns in the matrix.\u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eresult\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(_numberOfColumns);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e row = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; row \u0026lt; _numberOfRows; ++row) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e columnIndex = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row]; columnIndex \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rows\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e]; ++columnIndex) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e column = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_columns\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[columnIndex];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e      \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eresult\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[row] += \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_values\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[columnIndex] * \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[column];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e result;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":14,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="Vector SparseMatrixCSR::operator*(const Vector&amp; rhs) {
  assert(rhs.size() == _numberOfColumns &amp;&amp; &quot;Vector size does not match the number of columns in the matrix.&quot;);

  Vector result(_numberOfColumns);

  for (unsigned row = 0; row &lt; _numberOfRows; ++row) {
    for (unsigned columnIndex = _rows[row]; columnIndex &lt; _rows[row + 1]; ++columnIndex) {
      auto column = _columns[columnIndex];
      result[row] += _values[columnIndex] * rhs[column];
    }
  }

  return result;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4">::</span><span style="color: #C586C0">operator*</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #569CD6">&amp;</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">assert</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">() == _numberOfColumns &amp;&amp; </span><span style="color: #CE9178">&quot;Vector size does not match the number of columns in the matrix.&quot;</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">result</span><span style="color: #D4D4D4">(_numberOfColumns);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> row = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; row &lt; _numberOfRows; ++row) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> columnIndex = </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row]; columnIndex &lt; </span><span style="color: #9CDCFE">_rows</span><span style="color: #D4D4D4">[row + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">]; ++columnIndex) {</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> column = </span><span style="color: #9CDCFE">_columns</span><span style="color: #D4D4D4">[columnIndex];</span></span>
<span class="line"><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">result</span><span style="color: #D4D4D4">[row] += </span><span style="color: #9CDCFE">_values</span><span style="color: #D4D4D4">[columnIndex] * </span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">[column];</span></span>
<span class="line"><span style="color: #D4D4D4">    }</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> result;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>We do our usual check on line 2, in this case, making sure that both the matrix and vector have the correct size to be multiplied together. Then, we create a new vector on line 4 to store the resulting operation in, and then we carry out the matrix-vector multiplication on lines 6-11. We loop over each row, and then for each row, we simply loop over all column indices stored in our sparse matrix. On line 8, we retrieve the actual column index in the matrix, and then we compute essentially the dot product for each row on line 9. We can index our <code>_values</code> vector with the <code>columnIndex</code>, and the right-hand side vector with the column we retrieved from the <code>_columns</code> vector.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If we look at this code, we can see that we can compute each row independently, i.e. there is no need to exchange information between rows. This is excellent news if we want to parallelise our code, as this operation can be turned into a parallel code very efficiently as a result. This is why I mentioned above that the CSR format is so popular with CFD developers.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-summary">Summary</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This was a somewhat longer write-up but I hope you have gained now the required understanding of why we want to store matrices in a sparse data format in the first place, and secondly, how we actually go about implementing such a sparse matrix with the compressed sparse row (CSR) storage format.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This was a long article with lots of information to digest, so take a breather and try to digest the content in this article. You may want to read up a bit more on sparse matrices to solidify your knowledge in this area, for which some additional references given below may help. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As I have already mentioned, the article by <a href="https://matteding.github.io/2019/04/25/sparse-matrices/" target="_blank" rel="noopener" title="">Matt Eding on Sparse Matrices</a> is an excellent introduction. If you want to read more about sparse matrix data storage formats, as well as how to use them in a linear algebra package, I have found the <a href="https://netlib.org/linalg/html_templates/node4.html" target="_blank" rel="noopener" title="">netlib documentation</a> to be excellent. Their HTML-only approach to writing documentation may look outdated, but don't mistake outdated looks over content, the write-up is really good and goes into a lot of depth. They have additional information on the <a href="https://netlib.org/linalg/html_templates/node20.html#SECTION00731000000000000000" target="_blank" rel="noopener" title="">Conjugate Gradient</a> method (and related algorithms), as well as <a href="https://netlib.org/linalg/html_templates/node89.html#SECTION00930000000000000000" target="_blank" rel="noopener" title="">sparse matrix storage formats</a> (not just CSR).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We have now all the pieces together in our library and we can proceed to package our library, as well as compile and test it. We'll do all of that in the next article.</p>
<!-- /wp:paragraph -->