<!-- wp:paragraph -->
<p>When it comes to Computational Fluid Dynamics (CFD) applications, the Conjugate Gradient (CG) method is one of the more used algorithms to solve the linear system of equations [katex]\mathbf{Ax}=\mathbf{b}[/katex]. It offers fast convergence, low storage requirements, and is relatively easy to implement. In this week's article, we'll look at how we can implement this algorithm into our CFD library and use it later to solve our heat diffusion equation.</p>
<!-- /wp:paragraph -->

<!-- wp:block {"ref":2490} /-->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong>Download</strong>: <a href="https://cfd.university/download/linearalgebralib-part-4-the-conjugate-gradient-class/?tmstv=1712896293" title="">linearAlgebraLib-Part-4-The-Conjugate-Gradient-class.zip</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this series</h2>
<!-- /wp:heading -->

<!-- wp:shortcode -->
[custom_category_posts_list category_slug="how-to-compile-write-and-use-cfd-libraries-in-c"]
<!-- /wp:shortcode -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this article</h2>
<!-- /wp:heading -->

<!-- wp:aioseo/table-of-contents {"headings":[{"id":7,"blockClientId":"1de923fa-6a6c-47f7-b110-0e2292501960","content":"How we got here","level":2,"anchor":"aioseo-where-to-go-from-here","order":0,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":13,"blockClientId":"f87bddc5-caf0-491a-a678-cdb0b1fc23e0","content":"The Conjugate Gradient algorithm","level":2,"anchor":"aioseo-the-conjugate-gradient-algorithm","order":1,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":26,"blockClientId":"d4f85765-47de-43b1-b503-25bab1db5c69","content":"An abstract base class for our matrix solvers","level":2,"anchor":"aioseo-an-abstract-base-class-for-our-matrix-solvers","order":2,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":39,"blockClientId":"1102adf1-7456-4803-9109-ae2a4a238f1e","content":"The derived Conjugate Gradient class","level":2,"anchor":"aioseo-the-derived-conjugate-gradient-class","order":3,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":50,"blockClientId":"b7f3c357-c2e3-4bba-b9fa-d822843c6d02","content":"Summary","level":2,"anchor":"aioseo-summary","order":4,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]} -->
<div class="wp-block-aioseo-table-of-contents"><ul><li><a href="#aioseo-where-to-go-from-here">How we got here</a></li><li><a href="#aioseo-the-conjugate-gradient-algorithm">The Conjugate Gradient algorithm</a></li><li><a href="#aioseo-an-abstract-base-class-for-our-matrix-solvers">An abstract base class for our matrix solvers</a></li><li><a href="#aioseo-the-derived-conjugate-gradient-class">The derived Conjugate Gradient class</a></li><li><a href="#aioseo-summary">Summary</a></li></ul></div>
<!-- /wp:aioseo/table-of-contents -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-where-to-go-from-here">How we got here</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Thus far, we have looked at the heat diffusion equation and discretised it in a <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-discretising-the-model-equation" target="_blank" rel="noopener" title="">previous article</a> using the finite volume method. We looked at explicit and implicit time integration techniques and concluded that for equations that do not have a time derivative we need to use an implicit discretisation. The implicit discretisation requires a linear system of equations solver and we concluded that this is best handled by a library, which can be used over and over again for different discretised equations.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-basic-library-structure" target="_blank" rel="noopener" title="">last week's article</a>, then, we looked at how to flesh out a basic library structure to house the code for our linear system of equations solver. We also wrote a test code that implemented the discretised heat diffusion equation using our library which we haven't written yet; this allowed us to design the interface of our library, i.e. how we want to call library functions, their names, their order, etc. We'll use that test to ensure the correctness of our library code.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In this week's article, I want to start looking at some library code. We will first start with the conjugate gradient algorithm, which we seek to implement in our library. The algorithm will not work as we have yet to define our matrix and vector class. But what it does allow us to do is to write code that shows us which functions we need to implement on the vector and matrix class side, especially operators we want to overload. If we want to look back at our basic library structure, here is what we are going to deal with this week:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"root\n├── build\n├── linearAlgebraLib\n│   ├── linearAlgebraLib.hpp\n│   └── src\n│       ├── vector.(hpp|cpp)\n│       ├── sparseMatrixCSR.(hpp|cpp)\n│       ├── linearAlgebraSolverBase.(hpp|cpp) // current article\n│       └── conjugateGradient.(hpp|cpp)       // current article\n├── main.cpp\n└── buildAndRun.(sh|bat)","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003eroot\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── build\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   ├── \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ehpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   └── src\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── vector.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── sparseMatrixCSR.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── linearAlgebraSolverBase.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // current article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       └── conjugateGradient.(hpp|cpp)\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e       // current article\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e└── buildAndRun.(sh|bat)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":11,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="root
├── build
├── linearAlgebraLib
│   ├── linearAlgebraLib.hpp
│   └── src
│       ├── vector.(hpp|cpp)
│       ├── sparseMatrixCSR.(hpp|cpp)
│       ├── linearAlgebraSolverBase.(hpp|cpp) // current article
│       └── conjugateGradient.(hpp|cpp)       // current article
├── main.cpp
└── buildAndRun.(sh|bat)" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">root</span></span>
<span class="line"><span style="color: #D4D4D4">├── build</span></span>
<span class="line"><span style="color: #D4D4D4">├── linearAlgebraLib</span></span>
<span class="line"><span style="color: #D4D4D4">│   ├── </span><span style="color: #9CDCFE">linearAlgebraLib</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">hpp</span></span>
<span class="line"><span style="color: #D4D4D4">│   └── src</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── vector.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── sparseMatrixCSR.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── linearAlgebraSolverBase.(hpp|cpp)</span><span style="color: #6A9955"> // current article</span></span>
<span class="line"><span style="color: #D4D4D4">│       └── conjugateGradient.(hpp|cpp)</span><span style="color: #6A9955">       // current article</span></span>
<span class="line"><span style="color: #D4D4D4">├── </span><span style="color: #9CDCFE">main</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">cpp</span></span>
<span class="line"><span style="color: #D4D4D4">└── buildAndRun.(sh|bat)</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>So with this preamble out of the way, let's look at the conjugate gradient algorithm next.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-the-conjugate-gradient-algorithm">The Conjugate Gradient algorithm</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>When it comes to iterative matrix solvers, the conjugate gradient algorithm is one of the most used ones in the field of computational fluid dynamics. Found in many commercial and open-source CFD solvers, such as Siemens' Star CCM+ and OpenFOAM, it is typically an essential building block for fast convergence.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The conjugate gradient algorithm seeks to minimise the following quadratic function:</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>f(\mathbf{x})=\frac{1}{2}\mathbf{x}^T\mathbf{A}\mathbf{x}-\mathbf{x}^T\mathbf{b}</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>It just so happens that [katex]f(\mathbf{x})[/katex] at its minimum corresponds to the solution of [katex]\mathbf{Ax}=\mathbf{b}[/katex]. So, instead of solving our linear system of equations, we can transform our problem into one of finding the minimum to [katex]f(\mathbf{x})[/katex]. This is now a geometric task and finding the minimum can be simply done by picking any point on [katex]f(\mathbf{x})[/katex], calculating its gradient and then going towards the minimum. We repeat this step and iteratively approach the minimum, at which point we have recovered the solution to [katex]\mathbf{Ax}=\mathbf{b}[/katex].</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you are interested in a full walk-through of the algorithm and how we get to its final form, I can only recommend the following two lectures on the conjugate gradient method (and the method of steepest decent, which is a simplified form of the algorithm). You'll need to set some time aside, but it'll be worth your time:</p>
<!-- /wp:paragraph -->

<!-- wp:columns -->
<div class="wp-block-columns"><!-- wp:column -->
<div class="wp-block-column"><!-- wp:embed {"url":"https://www.youtube.com/watch?v=jXShvxPcRl4","type":"video","providerNameSlug":"youtube","responsive":true,"className":"wp-embed-aspect-16-9 wp-has-aspect-ratio"} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://www.youtube.com/watch?v=jXShvxPcRl4
</div></figure>
<!-- /wp:embed --></div>
<!-- /wp:column -->

<!-- wp:column -->
<div class="wp-block-column"><!-- wp:embed {"url":"https://www.youtube.com/watch?v=MdPhVsgTc1Q","type":"video","providerNameSlug":"youtube","responsive":true,"className":"wp-embed-aspect-16-9 wp-has-aspect-ratio"} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://www.youtube.com/watch?v=MdPhVsgTc1Q
</div></figure>
<!-- /wp:embed --></div>
<!-- /wp:column --></div>
<!-- /wp:columns -->

<!-- wp:paragraph -->
<p>We'll be content in this article with the final form of the conjugate gradient algorithm, and we will not dive too deep into the theory, after all, we want to see the algorithm in code and how it works, and provide a working library implementation.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Below is an outline for the conjugate gradient algorithm taken from <a href="https://en.wikipedia.org/wiki/Conjugate_gradient_method" target="_blank" rel="noopener" title="">here</a>. We'll use this pseudo code to implement our version of it into our library.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2112,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image size-full"><img src="https://cfd.university/wp-content/uploads/2023/11/conjugate_gradient_algorithm.svg" alt="" class="wp-image-2112"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Here, [katex]\mathbf{r}_0[/katex] is the starting residual, either computed from the initial solution or the previous iteration. Once this number becomes smaller than a convergence threshold, we have found our solution.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>[katex]\mathbf{b}[/katex] is the right-hand side vector, containing boundary conditions and explicit contributions, [katex]\mathbf{A}[/katex] is the coefficient matrix and will depend both on the equation that is being solved, as well as the numerical schemes that are used. [katex]\mathbf{x}_0[/katex] is the solution vector (in our case the temperature), and the subscript indicates that this vector will be iteratively updated.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>[katex]\mathbf{p}[/katex] represents the search direction, i.e. in which direction we are marching to get towards the minimum of [katex]f(\mathbf{x})[/katex], while [katex]k[/katex] is simply the iteration count. The two scalars [katex]\alpha[/katex] and [katex]\beta[/katex] are used to determine how far we are going along a gradient, and by how much to update the new search direction from the previous one ([katex]\mathbf{r}[/katex]) to the new one ([katex]\mathbf{p}[/katex]), respectively. We iteratively solve this problem until convergence is reached, which is judged based on [katex]\mathbf{r}[/katex]. Given that [katex]\mathbf{r}[/katex] is the residual of the linear system, i.e. [katex]\mathbf{r}=\mathbf{b}-\mathbf{Ax}[/katex], once it is sufficiently small, convergence is reached.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-an-abstract-base-class-for-our-matrix-solvers">An abstract base class for our matrix solvers</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We know which algorithm we want to implement, and we will limit ourselves to the conjugate gradient algorithm here. However, in theory, we may want to have more than just a single iterative matrix solver. Whenever we are in a position where we have an overarching type, from which many more specialised types derive, we have a classical inheritance problem in C++ (or more broadly in object-orientated programming), and we should be providing a base class.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Now, there is one caveat: <a href="https://en.wikipedia.org/wiki/Kent_Beck" target="_blank" rel="noopener" title="">Kent Beck</a> introduced extreme programming (XP), a philosophy widely practised in software engineering (and something we ought to talk about in the future!). It features a variety of components, one of them being <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it" target="_blank" rel="noopener" title="">YAGNI</a> (you aren't gonna need it). The idea here is to not write a single line of code if it is not actually needed. So in our case, we said that we only wanted to implement the conjugate gradient algorithm. If we only have a single derived class, then inheritance becomes redundant and YAGNI tells us to just use a single class.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This example is, however, overly simplified, I want to still provide a base class to simulate the case of having more than a single derived class (which would be typically the case for a library). So don't send in those angry memes just yet, there is a reason for it. In reality, we have all of these guiding mantras which we have to break every now and then if we have a good reason to. That's not my conclusion but directly taken from <a href="https://blog.cleancoder.com/" target="_blank" rel="noopener" title="">Uncle Bob's</a> book <a href="https://www.oreilly.com/library/view/clean-code-a/9780136083238/" target="_blank" rel="noopener" title="">Clean Code: A Handbook of Agile Software Craftsmanship</a> (and yes, everyone calls him Uncle Bob, that's not just me being weird and another excellent book we ought to discuss in the future).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>So then, let's look at our abstract base class. The header file is shown below:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#pragma once\n\n#include \u0022linearAlgebraLib/src/sparseMatrixCSR.hpp\u0022\n#include \u0022linearAlgebraLib/src/vector.hpp\u0022\n\nnamespace linearAlgebraLib {\n\nclass LinearAlgebraSolverBase {\npublic:\n  LinearAlgebraSolverBase(unsigned numberOfCells);\n  virtual ~LinearAlgebraSolverBase() = default;\n\n  void setCoefficientMatrix(const SparseMatrixCSR \u0026amp;matrix);\n  void setRightHandSide(const Vector \u0026amp;rhs);\n  \n  virtual Vector solve(unsigned maxIterations, double convergenceThreshold) = 0;\n\nprotected:\n  SparseMatrixCSR _coefficientMatrix;\n  Vector _rightHandSide;\n};\n\n} // namespace linearAlgebraLib","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#pragma\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eonce\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/sparseMatrixCSR.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/vector.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003enumberOfCells\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e~LinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() = \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edefault\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetCoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ematrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetRightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003emaxIterations\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003econvergenceThreshold\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eprotected:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  SparseMatrixCSR _coefficientMatrix;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector _rightHandSide;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":23,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#pragma once

#include &quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;
#include &quot;linearAlgebraLib/src/vector.hpp&quot;

namespace linearAlgebraLib {

class LinearAlgebraSolverBase {
public:
  LinearAlgebraSolverBase(unsigned numberOfCells);
  virtual ~LinearAlgebraSolverBase() = default;

  void setCoefficientMatrix(const SparseMatrixCSR &amp;matrix);
  void setRightHandSide(const Vector &amp;rhs);
  
  virtual Vector solve(unsigned maxIterations, double convergenceThreshold) = 0;

protected:
  SparseMatrixCSR _coefficientMatrix;
  Vector _rightHandSide;
};

} // namespace linearAlgebraLib" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#pragma</span><span style="color: #569CD6"> </span><span style="color: #9CDCFE">once</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/vector.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">LinearAlgebraSolverBase</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">numberOfCells</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">~LinearAlgebraSolverBase</span><span style="color: #D4D4D4">() = </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setCoefficientMatrix</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">matrix</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">setRightHandSide</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">maxIterations</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">convergenceThreshold</span><span style="color: #D4D4D4">) = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">protected:</span></span>
<span class="line"><span style="color: #D4D4D4">  SparseMatrixCSR _coefficientMatrix;</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector _rightHandSide;</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>It isn't overly complicated! But let's point out a few things here. First, we are now using a <a href="https://www.learncpp.com/cpp-tutorial/naming-collisions-and-an-introduction-to-namespaces/" target="_blank" rel="noopener" title="">namespace</a> on line 6. We haven't talked about them before, but suffice it to say that namespaces are used to group classes into logical units. It avoids having classes with the same name defined in several places. For example, there already is a <code>vector</code> class implemented in the <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/the-power-of-the-standard-template-library-stl-in-c" target="_blank" rel="noopener" title="">standard template library (STL)</a>, and you know it better as the <code>std::vector</code>. We want to provide later our own vector class, so putting it in its own namespace avoids a naming conflict. Namespaces are followed by the <code>::</code> operator, so you can see that all STL containers are implemented in the <code>std</code> namespace.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>LinearAlgebraSovlerBase</code> class features only a few functions. We have the constructor and destructor as we would expect. We will require the <code>numberOfCells</code> argument in the constructor as we want to initialise our coefficient matrix and right-hand side vector during construction. The two functions <code>setCoefficientMatrix()</code> and <code>setRightHandSide()</code> should be self-explanatory and simply set [katex]\mathbf{A}[/katex] and [katex]\mathbf{b}[/katex], respectively.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>There also is one virtual function called <code>solve()</code>. If we were to implement different iterative algorithms to solve [katex]\mathbf{Ax}=\mathbf{b}[/katex], then all of these algorithms would have to derive from <code>LinearAlgebraLib::LinearAlgebraSolverBase</code> and then provide an implementation for the <code>solve()</code> function, that's it. They all would receive the coefficient matrix and right-hand side vector from their parent/base class. The function takes two arguments, one for the maximum number of iterations and the convergence threshold.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We see, in fact, that these two entities are stored on lines 19-20 within the <code>LinearAlgebraSolverBase</code> class. The types are imported on lines 3-4 and we'll look at these classes in turn in the next two articles.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>For completeness, let's also look at the source file of this class to see the implementations we can already provide:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0022linearAlgebraLib/src/linearAlgebraSolverBase.hpp\u0022\n#include \u0022linearAlgebraSolverBase.hpp\u0022\n\nnamespace linearAlgebraLib {\n\nLinearAlgebraSolverBase::LinearAlgebraSolverBase(unsigned numberOfCells) :\n  _coefficientMatrix(numberOfCells, numberOfCells), _rightHandSide(numberOfCells) { }\n\nvoid LinearAlgebraSolverBase::setCoefficientMatrix(const SparseMatrixCSR \u0026amp;matrix) {\n  _coefficientMatrix = matrix;\n}\n\nvoid LinearAlgebraSolverBase::setRightHandSide(const Vector \u0026amp;rhs) {\n  _rightHandSide = rhs;\n}\n\n} // namespace linearAlgebraLib\n","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraSolverBase.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e numberOfCells) :\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e_coefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells, numberOfCells), \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells) { }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetCoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eSparseMatrixCSR\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ematrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  _coefficientMatrix = matrix;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evoid\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetRightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003erhs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  _rightHandSide = rhs;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":18,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp&quot;
#include &quot;linearAlgebraSolverBase.hpp&quot;

namespace linearAlgebraLib {

LinearAlgebraSolverBase::LinearAlgebraSolverBase(unsigned numberOfCells) :
  _coefficientMatrix(numberOfCells, numberOfCells), _rightHandSide(numberOfCells) { }

void LinearAlgebraSolverBase::setCoefficientMatrix(const SparseMatrixCSR &amp;matrix) {
  _coefficientMatrix = matrix;
}

void LinearAlgebraSolverBase::setRightHandSide(const Vector &amp;rhs) {
  _rightHandSide = rhs;
}

} // namespace linearAlgebraLib
" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraSolverBase.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #4EC9B0">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> numberOfCells) :</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">_coefficientMatrix</span><span style="color: #D4D4D4">(numberOfCells, numberOfCells), </span><span style="color: #DCDCAA">_rightHandSide</span><span style="color: #D4D4D4">(numberOfCells) { }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">setCoefficientMatrix</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">SparseMatrixCSR</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">matrix</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  _coefficientMatrix = matrix;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">void</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">setRightHandSide</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">&amp;</span><span style="color: #9CDCFE">rhs</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  _rightHandSide = rhs;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span>
<span class="line"></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>One thing to note is that we have to include the <code>namespace</code> keyword here again. The constructor simply initialises the coefficient matrix [katex]\mathbf{A}[/katex] and right-hand side vector [katex]\mathbf{b}[/katex] with the correct size, while both setters on lines 9-11 and 13-15 set these entities, respectively. There is not much more to the class than this. All the implementation goes into the derived class, which we will look into next.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-the-derived-conjugate-gradient-class">The derived Conjugate Gradient class</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>After defining the interface, we can simply derive from it and provide a concrete implementation of it using the conjugate gradient algorithm, as discussed above. So let's look at the header file for the conjugate gradient method, which is shown in the following:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#pragma once\n\n#include \u0026lt;iostream\u003e\n\n#include \u0022linearAlgebraLib/src/linearAlgebraSolverBase.hpp\u0022\n#include \u0022linearAlgebraLib/src/sparseMatrixCSR.hpp\u0022\n#include \u0022linearAlgebraLib/src/vector.hpp\u0022\n\nnamespace linearAlgebraLib {\n\nclass ConjugateGradient : public LinearAlgebraSolverBase {\npublic:\n  ConjugateGradient(unsigned numberOfCells);\n  virtual Vector solve(unsigned maxIterations, double convergenceThreshold) final override;\n};\n\n} // namespace linearAlgebraLib","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#pragma\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eonce\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/sparseMatrixCSR.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/vector.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eclass\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eConjugateGradient\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e : \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003epublic:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eConjugateGradient\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003enumberOfCells\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003evirtual\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003emaxIterations\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003econvergenceThreshold\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003efinal\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eoverride\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":17,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#pragma once

#include &lt;iostream&gt;

#include &quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp&quot;
#include &quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;
#include &quot;linearAlgebraLib/src/vector.hpp&quot;

namespace linearAlgebraLib {

class ConjugateGradient : public LinearAlgebraSolverBase {
public:
  ConjugateGradient(unsigned numberOfCells);
  virtual Vector solve(unsigned maxIterations, double convergenceThreshold) final override;
};

} // namespace linearAlgebraLib" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#pragma</span><span style="color: #569CD6"> </span><span style="color: #9CDCFE">once</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/linearAlgebraSolverBase.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/sparseMatrixCSR.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/vector.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ConjugateGradient</span><span style="color: #D4D4D4"> : </span><span style="color: #569CD6">public</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">LinearAlgebraSolverBase</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #569CD6">public:</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">ConjugateGradient</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">numberOfCells</span><span style="color: #D4D4D4">);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">virtual</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">maxIterations</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">convergenceThreshold</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">final</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">override</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>We see that we inherit from the <code>LinearAlgebraSolverBase</code> class and again wrap everything into our <code>linearAlgebraLib</code> namespace. Apart from a constructor call, we only provide an implementation for the <code>solve()</code> function. Remember that anything marked as a pure virtual function (indicated by the <code>= 0</code> in the base class) needs to be implemented in the derived class, otherwise, we'll get a compilation error.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The source file contains the actual algorithm implementation and is given below:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0022linearAlgebraLib/src/conjugateGradient.hpp\u0022\n\nnamespace linearAlgebraLib {\n\nConjugateGradient::ConjugateGradient(unsigned numberOfCells) : LinearAlgebraSolverBase(numberOfCells) { }\n\nVector ConjugateGradient::solve(unsigned maxIterations, double convergenceThreshold) {\n  Vector r0(_rightHandSide.size());\n  Vector r1(_rightHandSide.size());\n  Vector p0(_rightHandSide.size());\n  Vector p1(_rightHandSide.size());\n  Vector x(_rightHandSide.size());\n\n  auto \u0026amp;A = _coefficientMatrix;\n  auto \u0026amp;b = _rightHandSide;\n  \n  double alpha = 0.0;\n  double beta = 0.0;\n\n  unsigned iteration = 0;\n\n  p1 = b - A * x;\n  r1 = b - A * x;\n\n  do {\n    r0 = r1;\n    p0 = p1;\n\n    alpha = (r0.transpose() * r0) / (p0.transpose() * (A * p0));\n    x = x + alpha * p0;\n    r1 = r0 - alpha * A * p0;\n    beta = (r1.transpose() * r1) / (r0.transpose() * r0);\n    p1 = r1 + beta * p0;\n\n    ++iteration;\n  } while (iteration \u0026lt; maxIterations \u0026amp;\u0026amp; r1.getL2Norm() \u003e convergenceThreshold);\n\n  return x;\n}\n\n} // namespace linearAlgebraLib","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/src/conjugateGradient.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003enamespace\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eConjugateGradient\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eConjugateGradient\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e numberOfCells) : \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eLinearAlgebraSolverBase\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells) { }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eVector\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003eConjugateGradient\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003emaxIterations\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003econvergenceThreshold\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003er0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003er1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ep0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ep1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ex\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003e_rightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esize\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u0026amp;A = _coefficientMatrix;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eauto\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u0026amp;b = _rightHandSide;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e alpha = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e beta = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e iteration = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  p1 = b - A * x;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  r1 = b - A * x;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003edo\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    r0 = r1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    p0 = p1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    alpha = (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003er0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etranspose\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() * r0) / (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ep0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etranspose\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() * (A * p0));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    x = x + alpha * p0;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    r1 = r0 - alpha * A * p0;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    beta = (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003er1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etranspose\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() * r1) / (\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003er0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etranspose\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() * r0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    p1 = r1 + beta * p0;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    ++iteration;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  } \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ewhile\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (iteration \u0026lt; maxIterations \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003er1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetL2Norm\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026gt; convergenceThreshold);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e x;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e // namespace linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":41,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &quot;linearAlgebraLib/src/conjugateGradient.hpp&quot;

namespace linearAlgebraLib {

ConjugateGradient::ConjugateGradient(unsigned numberOfCells) : LinearAlgebraSolverBase(numberOfCells) { }

Vector ConjugateGradient::solve(unsigned maxIterations, double convergenceThreshold) {
  Vector r0(_rightHandSide.size());
  Vector r1(_rightHandSide.size());
  Vector p0(_rightHandSide.size());
  Vector p1(_rightHandSide.size());
  Vector x(_rightHandSide.size());

  auto &amp;A = _coefficientMatrix;
  auto &amp;b = _rightHandSide;
  
  double alpha = 0.0;
  double beta = 0.0;

  unsigned iteration = 0;

  p1 = b - A * x;
  r1 = b - A * x;

  do {
    r0 = r1;
    p0 = p1;

    alpha = (r0.transpose() * r0) / (p0.transpose() * (A * p0));
    x = x + alpha * p0;
    r1 = r0 - alpha * A * p0;
    beta = (r1.transpose() * r1) / (r0.transpose() * r0);
    p1 = r1 + beta * p0;

    ++iteration;
  } while (iteration &lt; maxIterations &amp;&amp; r1.getL2Norm() &gt; convergenceThreshold);

  return x;
}

} // namespace linearAlgebraLib" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/src/conjugateGradient.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">namespace</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #4EC9B0">ConjugateGradient</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">ConjugateGradient</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> numberOfCells) : </span><span style="color: #DCDCAA">LinearAlgebraSolverBase</span><span style="color: #D4D4D4">(numberOfCells) { }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #4EC9B0">Vector</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ConjugateGradient</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">(</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">maxIterations</span><span style="color: #D4D4D4">, </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">convergenceThreshold</span><span style="color: #D4D4D4">) {</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">r0</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_rightHandSide</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">());</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">r1</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_rightHandSide</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">());</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">p0</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_rightHandSide</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">());</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">p1</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_rightHandSide</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">());</span></span>
<span class="line"><span style="color: #D4D4D4">  Vector </span><span style="color: #DCDCAA">x</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">_rightHandSide</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">size</span><span style="color: #D4D4D4">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> &amp;A = _coefficientMatrix;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">auto</span><span style="color: #D4D4D4"> &amp;b = _rightHandSide;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> alpha = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> beta = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> iteration = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  p1 = b - A * x;</span></span>
<span class="line"><span style="color: #D4D4D4">  r1 = b - A * x;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">do</span><span style="color: #D4D4D4"> {</span></span>
<span class="line"><span style="color: #D4D4D4">    r0 = r1;</span></span>
<span class="line"><span style="color: #D4D4D4">    p0 = p1;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">    alpha = (</span><span style="color: #9CDCFE">r0</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">transpose</span><span style="color: #D4D4D4">() * r0) / (</span><span style="color: #9CDCFE">p0</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">transpose</span><span style="color: #D4D4D4">() * (A * p0));</span></span>
<span class="line"><span style="color: #D4D4D4">    x = x + alpha * p0;</span></span>
<span class="line"><span style="color: #D4D4D4">    r1 = r0 - alpha * A * p0;</span></span>
<span class="line"><span style="color: #D4D4D4">    beta = (</span><span style="color: #9CDCFE">r1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">transpose</span><span style="color: #D4D4D4">() * r1) / (</span><span style="color: #9CDCFE">r0</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">transpose</span><span style="color: #D4D4D4">() * r0);</span></span>
<span class="line"><span style="color: #D4D4D4">    p1 = r1 + beta * p0;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">    ++iteration;</span></span>
<span class="line"><span style="color: #D4D4D4">  } </span><span style="color: #C586C0">while</span><span style="color: #D4D4D4"> (iteration &lt; maxIterations &amp;&amp; </span><span style="color: #9CDCFE">r1</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getL2Norm</span><span style="color: #D4D4D4">() &gt; convergenceThreshold);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> x;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">}</span><span style="color: #6A9955"> // namespace linearAlgebraLib</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Since I want to discuss this code alongside the pseudo-code, I'll repeat it here for convenience so we can avoid scrolling up and down.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2112,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image size-full"><img src="http://cfd.university/wp-content/uploads/2023/11/conjugate_gradient_algorithm.svg" alt="" class="wp-image-2112"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We first have to define a few vectors on lines 8-12 which we will use during the update. These have a trailing <code>0</code> and <code>1</code> and are equivalent to <code>k</code> and <code>k+1</code> in the pseudo-code above. We set the coefficient matrix and right-hand side vector on lines 14-15, which we get from the base class. On lines 17-23, we simply initialise a few variables and then on lines 25-36, we solve the conjugate gradient algorithm as shown in the pseudo-code above between the <code>repeat</code> and <code>end repeat</code> statements.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We see that we check convergence on line 36, where we stop the iterations either when the maximum allowable iterations have been reached or when the L2-norm of the residual has dropped below the convergence threshold. If that is the case, we return the solution <code>x</code> from our <code>solve()</code> function.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>That's all. While we have to provide the implementations for the vector and the matrix class, I hope you have seen that implementing the Conjugate Gradient method is not that difficult. In fact, implementing the matrix class is probably the most difficult part of the entire process (at least if we want to solve this problem efficiently), but we are getting ahead of ourselves. We have the conjugate gradient algorithm implemented, next up, we'll look at the vector class and see how we can provide all required implementations according to the above-shown implementation.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-summary">Summary</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This article looked at how we can implement the conjugate gradient algorithm for our linear algebra CFD library. We looked at the base class and then the derived class structure. We implemented the pseudo-code for the conjugate gradient algorithm and saw a stark resemblance between pseudo-code and C++ implementation. In next week's article, we see which <a href="https://cfd.university/learn/what-every-cfd-developer-needs-to-know-about-c/enhance-readability-with-operator-overloading-in-c" target="_blank" rel="noopener" title="">operators we have to overload</a> in order to achieve this easy-to-read syntax. We'll then get to the matrix class and see what tricks to employ to get an efficient sparse matrix implementation to work.</p>
<!-- /wp:paragraph -->