<!-- wp:paragraph -->
<p>In last week's article, we developed the discretised equation for the 1D heat diffusion equation using the finite volume method. We looked at why we need an implicit time integration technique and why this requires a linear system of equations solver. In this week's article, we'll explore how to set up a basic project structure that we'll use to code our library. We'll also write the code for the 1D heat equation solver, even though it won't compile yet without the library, but this provides us a test for the library and allows us to design the classes' interfaces. Let's get started!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Having a common library structure will help others to work with your library more easily. By the end of this article, you'll understand the basic library structure required to develop our (and, in fact, any other) library and we will build upon this structure in the next articles.</p>
<!-- /wp:paragraph -->

<!-- wp:block {"ref":2490} /-->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong>Download</strong>: <a href="https://cfd.university/download/linearalgebralib-part-3-basic-library-structure/?tmstv=1712896197" title="">linearAlgebraLib-Part-3-Basic-library-structure.zip</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this series</h2>
<!-- /wp:heading -->

<!-- wp:shortcode -->
[custom_category_posts_list category_slug="how-to-compile-write-and-use-cfd-libraries-in-c"]
<!-- /wp:shortcode -->

<!-- wp:heading -->
<h2 class="wp-block-heading">In this article</h2>
<!-- /wp:heading -->

<!-- wp:aioseo/table-of-contents {"headings":[{"id":8,"blockClientId":"d65b32f3-310a-48bb-ae1e-b159058d59c5","content":"Basic library structure","level":2,"anchor":"aioseo-basic-library-structure","order":0,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":15,"blockClientId":"38ffd4fe-8ecf-49e0-ab0f-692675869e74","content":"The \u0022linearAlgebraLib.hpp\u0022 header include file","level":2,"anchor":"aioseo-the-linearalgebralib-hpp-header-include-file","order":1,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":19,"blockClientId":"d47e0a81-294b-4c63-b139-fc0002c1b824","content":"Compiling and executing the library code","level":2,"anchor":"aioseo-compiling-and-executing-the-library-code","order":2,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[{"id":21,"blockClientId":"acf0bf08-e0ca-4364-8eec-623e6ae4b985","content":"Unix (Linux and macOS)","level":3,"anchor":"aioseo-unix-linux-and-macos","order":3,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":27,"blockClientId":"a6d0f466-43ca-432b-885a-7ae5a77ce98b","content":"Windows","level":3,"anchor":"aioseo-windows","order":4,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]},{"id":37,"blockClientId":"808983aa-485e-4d8a-9435-b7ed2cd4b427","content":"A first solver implementation of the heat equation","level":2,"anchor":"aioseo-required-classes","order":5,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]},{"id":54,"blockClientId":"04f78a02-86f6-450f-9cc0-1c25fc22ca7b","content":"Summary","level":2,"anchor":"aioseo-summary","order":6,"editedContent":"","editedLevel":0,"editedOrder":0,"hidden":false,"headings":[]}]} -->
<div class="wp-block-aioseo-table-of-contents"><ul><li><a href="#aioseo-basic-library-structure">Basic library structure</a></li><li><a href="#aioseo-the-linearalgebralib-hpp-header-include-file">The &#x22;linearAlgebraLib.hpp&#x22; header include file</a></li><li><a href="#aioseo-compiling-and-executing-the-library-code">Compiling and executing the library code</a><ul><li><a href="#aioseo-unix-linux-and-macos">Unix (Linux and macOS)</a></li><li><a href="#aioseo-windows">Windows</a></li></ul></li><li><a href="#aioseo-required-classes">A first solver implementation of the heat equation</a></li><li><a href="#aioseo-summary">Summary</a></li></ul></div>
<!-- /wp:aioseo/table-of-contents -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-basic-library-structure">Basic library structure</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Let's start by exploring the basic library structure that I'll be using. We assume that we have some root folder in which all of our files and directories reside. Within that folder, we have two folders and two files, one folder to collect all build and executable files, one folder for the library code itself, and then one file for the heat equation solver, as well as a script to compile and execute our solver. This structure is shown below:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"root\n├── build\n├── linearAlgebraLib\n│   ├── linearAlgebraLib.hpp\n│   └── src\n│       ├── vector.(hpp|cpp)\n│       ├── sparseMatrixCSR.(hpp|cpp)\n│       ├── linearAlgebraSolverBase.(hpp|cpp)\n│       └── conjugateGradient.(hpp|cpp)\n├── main.cpp\n└── buildAndRun.(sh|bat)","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003eroot\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── build\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── linearAlgebraLib\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   ├── linearAlgebraLib.hpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│   └── src\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── vector.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── sparseMatrixCSR.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       ├── linearAlgebraSolverBase.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e│       └── conjugateGradient.(hpp|cpp)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e├── main.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e└── buildAndRun.(sh|bat)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"plaintext","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":11,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="root
├── build
├── linearAlgebraLib
│   ├── linearAlgebraLib.hpp
│   └── src
│       ├── vector.(hpp|cpp)
│       ├── sparseMatrixCSR.(hpp|cpp)
│       ├── linearAlgebraSolverBase.(hpp|cpp)
│       └── conjugateGradient.(hpp|cpp)
├── main.cpp
└── buildAndRun.(sh|bat)" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">root</span></span>
<span class="line"><span style="color: #D4D4D4">├── build</span></span>
<span class="line"><span style="color: #D4D4D4">├── linearAlgebraLib</span></span>
<span class="line"><span style="color: #D4D4D4">│   ├── linearAlgebraLib.hpp</span></span>
<span class="line"><span style="color: #D4D4D4">│   └── src</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── vector.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── sparseMatrixCSR.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">│       ├── linearAlgebraSolverBase.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">│       └── conjugateGradient.(hpp|cpp)</span></span>
<span class="line"><span style="color: #D4D4D4">├── main.cpp</span></span>
<span class="line"><span style="color: #D4D4D4">└── buildAndRun.(sh|bat)</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>The <code>linearAlgebraLib</code> folder contains the actual library code that we will develop. We have a header include file named <code>linearAlgebraLib.hpp</code>, which is the file we will later include in our code to make use of the library. Within the <code>src</code> folder, we have all required library classes.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>vector.(hpp|cpp)</code> files contain a class <code>Vector</code> that provides some overloaded operators, predominantly, so that we can write easy vector-vector and matrix-vector multiplications. The <code>sparseMatrixCSR.(hpp|cpp)</code> files, on the other hand, define the <code>SparseMatrixCSR</code> class which we'll be using to store our coefficients. It is a sparse matrix and uses the compressed row storage (CRS) data structure, which allows us to only store non-zero elements in the matrix to reduce memory requirements. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>linearAlgebraSolverBase.(hpp|cpp)</code> files define an interface for a matrix solver to implement, and we define here just one such matrix solver based on the conjugate gradient method (within the <code>conjugateGradient.(hpp|cpp)</code> files). This is the file where we will solve the actual implementation of [katex]x=A\b[/katex].</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Finally, within the <code>main.cpp</code> file, we will define a test that we will use to make sure the conjugate gradient algorithm has worked, which is the implementation of the heat equation that we have discretised <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-discretising-the-model-equation/" target="_blank" rel="noopener" title="">in the previous article</a>. Furthermore, the <code>buildAndRun.(sh|bat)</code> files provide scripts for either UNIX (Linux/macOS) or Windows to compile and run the code. Ideally, these should be replaced by a build script but we have not looked at them yet, so this is something we'll return to in the future.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-the-linearalgebralib-hpp-header-include-file">The "linearAlgebraLib.hpp" header include file</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Each library comes with at least one header-include file. The job of this file is to provide an entry point into your library. Other programmers can use your library by including this header file in their code. If your library gets particularly big, then you may have more than one header file, but in our case, we are looking at a relatively small library, so we'll stick with a single header file. The content of the <code>linearAlgebraLib.hpp</code> file is given below:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0022src/sparseMatrixCSR.hpp\u0022\n#include \u0022src/vector.hpp\u0022\n#include \u0022src/linearAlgebraSolverBase.hpp\u0022\n#include \u0022src/conjugateGradient.hpp\u0022","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;src/sparseMatrixCSR.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;src/vector.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;src/linearAlgebraSolverBase.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;src/conjugateGradient.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":4,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(1 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &quot;src/sparseMatrixCSR.hpp&quot;
#include &quot;src/vector.hpp&quot;
#include &quot;src/linearAlgebraSolverBase.hpp&quot;
#include &quot;src/conjugateGradient.hpp&quot;" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;src/sparseMatrixCSR.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;src/vector.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;src/linearAlgebraSolverBase.hpp&quot;</span></span>
<span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;src/conjugateGradient.hpp&quot;</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>All that this file does is include the respective header files for each class that is located in the <code>src</code> folder, i.e. where we keep all of our source files (<code>*.hpp</code> and <code>*.cpp</code> files). Later, when we want to use the library, all we do is include this header file in our code and the remaining headers will be loaded. We need to compile all <code>*.cpp</code> files along with our project (for now), but later will see how we can separate the compilation process for our library from the compilation process of our <code>main.cpp</code> file (the way an actual library would be compiled and used).</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-compiling-and-executing-the-library-code">Compiling and executing the library code</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>In our project structure above, we saw that we have a <code>buildAndRun.sh</code> and <code>buildAndRun.bat</code> file, which can be used to compile our library code. We use the <code>buildAndRun.sh</code> file on UNIX (Linux, macOS) and the <code>buildAndRun.bat</code> file for Windows. Let's look into the these files in turn.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-unix-linux-and-macos">Unix (Linux and macOS)</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>The content of the <code>buildAndRun.sh</code> file looks as follows:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#!/bin/bash\n\nrm -rf build\nmkdir -p build\n\n# compile\ng++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/sparseMatrixCSR.cpp -o build/sparseMatrixCSR.o\ng++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/vector.cpp -o build/vector.o\ng++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/linearAlgebraSolverBase.cpp -o build/linearAlgebraSolver.o\ng++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/conjugateGradient.cpp -o build/conjugateGradient.o\ng++ -c -g -O0 -Wall -Wextra -I. main.cpp -o build/main.o\n\n# link\ng++ -o build/main.out build/sparseMatrixCSR.o build/vector.o build/linearAlgebraSolver.o build/conjugateGradient.o build/main.o\n\n# run\n./build/main.out","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003erm\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-rf\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emkdir\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-p\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e# compile\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-c\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-g\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-O0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wall\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wextra\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-I.\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003elinearAlgebraLib/src/sparseMatrixCSR.cpp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/sparseMatrixCSR.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-c\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-g\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-O0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wall\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wextra\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-I.\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003elinearAlgebraLib/src/vector.cpp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/vector.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-c\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-g\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-O0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wall\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wextra\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-I.\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003elinearAlgebraLib/src/linearAlgebraSolverBase.cpp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/linearAlgebraSolver.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-c\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-g\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-O0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wall\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wextra\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-I.\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003elinearAlgebraLib/src/conjugateGradient.cpp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/conjugateGradient.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-c\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-g\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-O0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wall\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-Wextra\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-I.\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003emain.cpp\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/main.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e# link\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eg++\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e-o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/main.out\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/sparseMatrixCSR.o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/vector.o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/linearAlgebraSolver.o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/conjugateGradient.o\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003ebuild/main.o\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e# run\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003e./build/main.out\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"bash","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":17,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#!/bin/bash

rm -rf build
mkdir -p build

# compile
g++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/sparseMatrixCSR.cpp -o build/sparseMatrixCSR.o
g++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/vector.cpp -o build/vector.o
g++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/linearAlgebraSolverBase.cpp -o build/linearAlgebraSolver.o
g++ -c -g -O0 -Wall -Wextra -I. linearAlgebraLib/src/conjugateGradient.cpp -o build/conjugateGradient.o
g++ -c -g -O0 -Wall -Wextra -I. main.cpp -o build/main.o

# link
g++ -o build/main.out build/sparseMatrixCSR.o build/vector.o build/linearAlgebraSolver.o build/conjugateGradient.o build/main.o

# run
./build/main.out" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #6A9955">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #DCDCAA">rm</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-rf</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build</span></span>
<span class="line"><span style="color: #DCDCAA">mkdir</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-p</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># compile</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-c</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-O0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wall</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wextra</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-I.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">linearAlgebraLib/src/sparseMatrixCSR.cpp</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/sparseMatrixCSR.o</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-c</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-O0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wall</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wextra</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-I.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">linearAlgebraLib/src/vector.cpp</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/vector.o</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-c</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-O0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wall</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wextra</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-I.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">linearAlgebraLib/src/linearAlgebraSolverBase.cpp</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/linearAlgebraSolver.o</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-c</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-O0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wall</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wextra</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-I.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">linearAlgebraLib/src/conjugateGradient.cpp</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/conjugateGradient.o</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-c</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-g</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-O0</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wall</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-Wextra</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-I.</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">main.cpp</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/main.o</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># link</span></span>
<span class="line"><span style="color: #DCDCAA">g++</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">-o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/main.out</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/sparseMatrixCSR.o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/vector.o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/linearAlgebraSolver.o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/conjugateGradient.o</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">build/main.o</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955"># run</span></span>
<span class="line"><span style="color: #DCDCAA">./build/main.out</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>We create a build directory on line 1 and then compile all library code along with the <code>main.cpp</code> file on lines 7-11. On line 14, we link all code together and finally execute the compiled executable on line 17. Note, if you are using this file and don't have <code>g++</code> installed, install <code>gcc</code> first through your package manager (use <code>sudo apt install gcc</code> on Ubuntu and <code>brew install gcc</code> on macOS. For Ubuntu, I would recommend installing the <code>build-essential</code> package, which does contain <code>gcc/g++</code> and a range of other useful developer tools and libraries, in this case, use <code>sudo apt install build-essential</code>).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Here, the compiler flags mean the following:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>-<code>c</code>: Compile the current file only into an object, but don't link it just yet.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>-g</code>: Include debugging information, useful for when we want to step through our code to find bugs.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>-O0</code>: Lowest level of code optimisation, i.e. level <code>0</code> (= no optimisation).</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>-Wall</code>: (W)arn all = Turn all (useful) compiler warnings on. It does not contain all compiler warnings that exist, but it will include the most commonly used one</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>-<code>Wextra</code>: Turn on some extra warnings and compiler checks. Together with <code>-Wall</code>, the compiler will do a good job of warning us of any potential syntactic issues in our code.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>-I.</code>: Include the root folder (indicated by <code>.</code>) as a search path for header files. The root folder is defined as the folder from where we call the compiler, which in this case is the root folder as this one contains our <code>buildAndRun.(sh|bat)</code> scripts. We do this so that we can import any header files relative to the root directory. If we do not include the <code>-I.</code> flag, then we need to specify all paths as absolute paths, which will break your code if you want to execute your code on a different machine.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>-o</code>: Directory where to put the compiled code, i.e. in this case we want to move everything into the <code>build</code> folder that we generated on line 1.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading" id="aioseo-windows">Windows</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>On Windows, we make use of the <code>buildAndRun.bat</code> file and its content looks as follows:</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"@echo off\n\ndel /q build\nmkdir build\n\nREM compile\ncl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\sparseMatrixCSR.obj linearAlgebraLib\\src\\sparseMatrixCSR.cpp\ncl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\vector.obj linearAlgebraLib\\src\\vector.cpp\ncl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\linearAlgebraSolver.obj linearAlgebraLib\\src\\linearAlgebraSolverBase.cpp\ncl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\conjugateGradient.obj linearAlgebraLib\\src\\conjugateGradient.cpp\ncl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\main.obj main.cpp\n\nREM link\ncl /Fe:build\\main.exe build\\sparseMatrixCSR.obj build\\vector.obj build\\linearAlgebraSolver.obj build\\conjugateGradient.obj build\\main.obj\n\nREM run\nbuild\\main.exe","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e@\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eecho\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eoff\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edel\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e /q build\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003emkdir\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e build\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eREM\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e compile\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\sparseMatrixCSR.obj linearAlgebraLib\\src\\sparseMatrixCSR.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\vector.obj linearAlgebraLib\\src\\vector.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\linearAlgebraSolver.obj linearAlgebraLib\\src\\linearAlgebraSolverBase.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\conjugateGradient.obj linearAlgebraLib\\src\\conjugateGradient.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /nologo /c /EHsc /Zi /Od /I. /Fobuild\\main.obj main.cpp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eREM\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e link\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ecl /Fe:build\\main.exe build\\sparseMatrixCSR.obj build\\vector.obj build\\linearAlgebraSolver.obj build\\conjugateGradient.obj build\\main.obj\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eREM\u003c/span\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e run\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003ebuild\\main.exe\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"bat","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":17,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="@echo off

del /q build
mkdir build

REM compile
cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\sparseMatrixCSR.obj linearAlgebraLib\src\sparseMatrixCSR.cpp
cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\vector.obj linearAlgebraLib\src\vector.cpp
cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\linearAlgebraSolver.obj linearAlgebraLib\src\linearAlgebraSolverBase.cpp
cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\conjugateGradient.obj linearAlgebraLib\src\conjugateGradient.cpp
cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\main.obj main.cpp

REM link
cl /Fe:build\main.exe build\sparseMatrixCSR.obj build\vector.obj build\linearAlgebraSolver.obj build\conjugateGradient.obj build\main.obj

REM run
build\main.exe" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #D4D4D4">@</span><span style="color: #569CD6">echo</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">off</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">del</span><span style="color: #D4D4D4"> /q build</span></span>
<span class="line"><span style="color: #569CD6">mkdir</span><span style="color: #D4D4D4"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">REM</span><span style="color: #6A9955"> compile</span></span>
<span class="line"><span style="color: #D4D4D4">cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\sparseMatrixCSR.obj linearAlgebraLib\src\sparseMatrixCSR.cpp</span></span>
<span class="line"><span style="color: #D4D4D4">cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\vector.obj linearAlgebraLib\src\vector.cpp</span></span>
<span class="line"><span style="color: #D4D4D4">cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\linearAlgebraSolver.obj linearAlgebraLib\src\linearAlgebraSolverBase.cpp</span></span>
<span class="line"><span style="color: #D4D4D4">cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\conjugateGradient.obj linearAlgebraLib\src\conjugateGradient.cpp</span></span>
<span class="line"><span style="color: #D4D4D4">cl /nologo /c /EHsc /Zi /Od /I. /Fobuild\main.obj main.cpp</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">REM</span><span style="color: #6A9955"> link</span></span>
<span class="line"><span style="color: #D4D4D4">cl /Fe:build\main.exe build\sparseMatrixCSR.obj build\vector.obj build\linearAlgebraSolver.obj build\conjugateGradient.obj build\main.obj</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">REM</span><span style="color: #6A9955"> run</span></span>
<span class="line"><span style="color: #D4D4D4">build\main.exe</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>To use that file, make sure you have Visual Studio installed (either the community, professional or enterprise edition) and that you have a suitable C++ development environment installed. Search on your Windows search bar for <code>Visual Studio Installer</code>, select the version of Visual Studio that you want to use (you probably only see one version) and select the Modify button. Next, select a package that contains <code>MSVC</code> and a C++ compiler as a minimum. In my case, I use the <code>Desktop Development with C++</code> package, which contains the most useful C++ tools and is loosely related to the build-essential package on Ubuntu.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>When you start a new PowerShell session, you want to start the Visual Studio developer version of the PowerShell (in my case, it is called Developer PowerShell for VS 2022), which will set up your terminal so that you can use the compiler straight away. Alternatively, you can start a normal PowerShell session and then source the files manually. Type the following command and ensure the file exists at the specified path, you may have to change the version and/or the flavour of your Visual Studio installation (Community, Professional, Enterprise)</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><code>cmd.exe /k "C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsall.bat" amd64</code></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>amd64</code> at the end just specifies my PC's architecture and in this day and age you should have a 64-bit processor as well (unless you insist on developing on a Surface Pro, in which case you may still have a 32-bit processor, and the command should be replaced with <code>x86</code> (yes I know, makes perfect sense ...)). </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The actual commands are essentially the same on Windows as on UNIX, the syntax just changes, i.e. we have <code>/c</code> for compiling but not linking, <code>/Zi</code> for debugging information, <code>/Od</code> for no optimisation, <code>/I.</code> to include the root folder, and <code>/Fo</code> to specify the output file for the compiled code. On Windows, you get a compilation error if there is a space between <code>/Fo</code> and the location where you want to place that file, so make sure there is no space (see above as well for reference).</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The additional <code>/nologo</code> flag is probably best described as a spam filter, i.e. you are not getting unnecessary messages telling you that you are using Microsoft's compiler and the <code>/EHsc</code> flag is weirdly required for consistent exception-handling behaviour. We have also removed all compiler warnings, i.e. the equivalent of <code>-Wall</code> on UNIX can be achieved with <code>/Wall</code> on Windows. However, if you value your sanity, I'd strongly suggest to not use this flag. If you do, you'll get a flood of warnings from the standard template library (which is implemented by Microsoft themselves, job well done!)</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Both the <code>buildAndRun.sh</code> and <code>buildAndRun.bat</code> file will compile and run the main executable for us so that we can check any output printed to the console. With these files implemented, we are ready to look at our heat equation implementation.  </p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-required-classes">A first solver implementation of the heat equation</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>If you want to become a serious programmer, you'll have to embrace <a href="https://en.wikipedia.org/wiki/Software_testing" target="_blank" rel="noopener" title="">software testing</a> and make it a habit to follow <a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" rel="noopener" title="">test-driven development (TDD)</a> practices. I'll cover that in a future series, but in short, TDD requires us programmers to write a test for each piece of code that we intend to write. We write the test before we write code that will make that test work, and then we start to implement the code. We implement and refine our code until our test starts working, and then move on to the next test/implementation.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>There are a few philosophies about how we should structure our tests, but all what these tests are doing is to ensure that different components at different level work. For example, we provide small test pieces (called <em>unit tests</em>) that only test functions, but then also provide <em>integration </em>or <em>system tests </em>to test single classes and their combined behaviour, respectively.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>I'll skip the proper test set up for now, but what I do want to borrow from this concept is a system test approach to write our library. I want to write the code for the 1D heat equation upfront so that we can compile our library code and check if it is working for our intended use case. If it does, chances are it will work on other problems as well. This approach also allows us to design the interface to our classes, i.e. the function names, their arguments, and in which order they need to be called. This makes it easier to implement the classes later.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Having said that, the <code>main.cpp</code> function, which includes the entire discretised 1D heat equation example, is given below. The code won't compile as of now, as we have not provided any implementation for the library code. Once that is there and correctly implemented, you should see this code running without throwing an error message at the end.</p>
<!-- /wp:paragraph -->

<!-- wp:kevinbatdorf/code-block-pro {"code":"#include \u0022linearAlgebraLib/linearAlgebraLib.hpp\u0022\n\n// solve the heat equation implicitly of the form dT/dt = gamma * d^2 T/ dx^2\n// over a domain L using the conjugate gradient methdod\n// initial condition: 0 everywhere\n// boundary condition: T(0) = 0, T(L) = 1\nint main() {\n  // input variables\n  const double gamma = 1.0;\n  const unsigned numberOfCells = 100;\n  const double domainLength = 1.0;\n  const double boundaryValueLeft = 0.0;\n  const double boundaryValueRight = 1.0;\n  const double dx = domainLength / (numberOfCells);\n\n  // vectors and matrices\n  linearAlgebraLib::Vector coordinateX(numberOfCells);\n  linearAlgebraLib::Vector temperature(numberOfCells);\n  linearAlgebraLib::Vector boundaryConditions(numberOfCells);\n\n  linearAlgebraLib::SparseMatrixCSR coefficientMatrix(numberOfCells, numberOfCells);\n\n  // initialise arrays and set-up 1D mesh\n  for (unsigned i = 0; i \u0026lt; numberOfCells; ++i) {\n    coordinateX[i] = i * dx + dx / 2.0;\n    temperature[i] = 0.0;\n    boundaryConditions[i] = 0.0;\n  }\n\n  // calculate individual matrix coefficients\n  const double aE = gamma / dx;\n  const double aW = gamma / dx;\n  const double aP = -1.0 * (aE + aW);\n\n  // set individual matrix coefficients\n  for (unsigned i = 1; i \u0026lt; numberOfCells - 1; ++i) {\n    coefficientMatrix.set(i, i, aP);\n    coefficientMatrix.set(i, i + 1, aE);\n    coefficientMatrix.set(i, i - 1, aW);\n  }\n\n  coefficientMatrix.set(0, 0, -1.0 * (aE + 2.0 * aW));\n  coefficientMatrix.set(0, 1, aE);\n  coefficientMatrix.set(numberOfCells - 1, numberOfCells - 2, aW);\n  coefficientMatrix.set(numberOfCells - 1, numberOfCells - 1, -1.0 * (2.0 * aE + aW));\n\n  // set boundary conditions\n  boundaryConditions[0] = -2.0 * aW * boundaryValueLeft;\n  boundaryConditions[numberOfCells - 1] = -2.0 * aE * boundaryValueRight;\n\n  // solve the linear system using the conjugate gradient method\n  linearAlgebraLib::ConjugateGradient CGSolver(numberOfCells);\n  CGSolver.setCoefficientMatrix(coefficientMatrix);\n  CGSolver.setRightHandSide(boundaryConditions);\n  temperature = CGSolver.solve(100, 1e-10);\n\n  // the obtain temperature profile is a linear one of the form T(x) = x. Thus, we can compare it directly against\n  // the coordinate vector (which in this case acts as an analytic solution)\n  linearAlgebraLib::Vector difference(numberOfCells);\n  for (unsigned i = 0; i \u0026lt; numberOfCells; ++i) {\n    difference[i] += std::fabs(temperature[i] - coordinateX[i]);\n  }\n\n  // ensure that temperature has converged to at least single precision\n  assert(difference.getL2Norm() \u0026lt; 1e-8);\n\n  std::cout \u0026lt;\u0026lt; \u0022Simulation successful, final residual: \u0022 \u0026lt;\u0026lt; difference.getL2Norm() \u0026lt;\u0026lt; std::endl;\n  return 0;\n}","codeHTML":"\u003cpre class=\u0022shiki dark-plus\u0022 style=\u0022background-color: #1E1E1E\u0022 tabindex=\u00220\u0022\u003e\u003ccode\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003e#include\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;linearAlgebraLib/linearAlgebraLib.hpp\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e// solve the heat equation implicitly of the form dT/dt = gamma * d^2 T/ dx^2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e// over a domain L using the conjugate gradient methdod\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e// initial condition: 0 everywhere\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e// boundary condition: T(0) = 0, T(L) = 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eint\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003emain\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // input variables\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e gamma = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e numberOfCells = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e100\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e domainLength = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e boundaryValueLeft = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e boundaryValueRight = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e dx = domainLength / (numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // vectors and matrices\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ecoordinateX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003etemperature\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eboundaryConditions\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::SparseMatrixCSR \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells, numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // initialise arrays and set-up 1D mesh\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; numberOfCells; ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoordinateX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] = i * dx + dx / \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003etemperature\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eboundaryConditions\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // calculate individual matrix coefficients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e aE = gamma / dx;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e aW = gamma / dx;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003econst\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003edouble\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e aP = -\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * (aE + aW);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // set individual matrix coefficients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(i, i, aP);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(i, i + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, aE);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(i, i - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, aW);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, -\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * (aE + \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * aW));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, aE);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, aW);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eset\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, -\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * (\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * aE + aW));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // set boundary conditions\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eboundaryConditions\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e] = -\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * aW * boundaryValueLeft;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eboundaryConditions\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[numberOfCells - \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e] = -\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e2.0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e * aE * boundaryValueRight;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // solve the linear system using the conjugate gradient method\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::ConjugateGradient \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eCGSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eCGSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetCoefficientMatrix\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(coefficientMatrix);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eCGSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esetRightHandSide\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(boundaryConditions);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  temperature = \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003eCGSolver\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003esolve\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e100\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e, \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1e-10\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // the obtain temperature profile is a linear one of the form T(x) = x. Thus, we can compare it directly against\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // the coordinate vector (which in this case acts as an analytic solution)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003elinearAlgebraLib\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::Vector \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003edifference\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(numberOfCells);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003efor\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e (\u003c/span\u003e\u003cspan style=\u0022color: #569CD6\u0022\u003eunsigned\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e i = \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e; i \u0026lt; numberOfCells; ++i) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e    \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003edifference\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] += \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003efabs\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003etemperature\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i] - \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003ecoordinateX\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e[i]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #6A9955\u0022\u003e  // ensure that temperature has converged to at least single precision\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003eassert\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e(\u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003edifference\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetL2Norm\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e1e-8\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::cout \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #CE9178\u0022\u003e\u0026quot;Simulation successful, final residual: \u0026quot;\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #9CDCFE\u0022\u003edifference\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e.\u003c/span\u003e\u003cspan style=\u0022color: #DCDCAA\u0022\u003egetL2Norm\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e() \u0026lt;\u0026lt; \u003c/span\u003e\u003cspan style=\u0022color: #4EC9B0\u0022\u003estd\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e::endl;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e  \u003c/span\u003e\u003cspan style=\u0022color: #C586C0\u0022\u003ereturn\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e \u003c/span\u003e\u003cspan style=\u0022color: #B5CEA8\u0022\u003e0\u003c/span\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\u0022line\u0022\u003e\u003cspan style=\u0022color: #D4D4D4\u0022\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","language":"cpp","theme":"dark-plus","bgColor":"#1E1E1E","textColor":"#D4D4D4","fontSize":".875rem","fontFamily":"Code-Pro-JetBrains-Mono","lineHeight":"1.25rem","clampFonts":false,"lineNumbers":true,"headerType":"none","disablePadding":false,"footerType":"none","enableMaxHeight":false,"seeMoreType":"","seeMoreString":"","seeMoreAfterLine":"","seeMoreTransition":false,"highestLineNumber":69,"highlightingHover":false,"lineHighlightColor":"rgba(234, 191, 191, 0.2)","copyButton":true,"copyButtonType":"heroicons","useTabs":false} -->
<div class="wp-block-kevinbatdorf-code-block-pro cbp-has-line-numbers" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#D4D4D4;--cbp-line-number-width:calc(2 * 0.6 * .875rem);line-height:1.25rem;--cbp-tab-width:2;tab-size:var(--cbp-tab-width, 2)"><span role="button" tabindex="0" data-code="#include &quot;linearAlgebraLib/linearAlgebraLib.hpp&quot;

// solve the heat equation implicitly of the form dT/dt = gamma * d^2 T/ dx^2
// over a domain L using the conjugate gradient methdod
// initial condition: 0 everywhere
// boundary condition: T(0) = 0, T(L) = 1
int main() {
  // input variables
  const double gamma = 1.0;
  const unsigned numberOfCells = 100;
  const double domainLength = 1.0;
  const double boundaryValueLeft = 0.0;
  const double boundaryValueRight = 1.0;
  const double dx = domainLength / (numberOfCells);

  // vectors and matrices
  linearAlgebraLib::Vector coordinateX(numberOfCells);
  linearAlgebraLib::Vector temperature(numberOfCells);
  linearAlgebraLib::Vector boundaryConditions(numberOfCells);

  linearAlgebraLib::SparseMatrixCSR coefficientMatrix(numberOfCells, numberOfCells);

  // initialise arrays and set-up 1D mesh
  for (unsigned i = 0; i &lt; numberOfCells; ++i) {
    coordinateX[i] = i * dx + dx / 2.0;
    temperature[i] = 0.0;
    boundaryConditions[i] = 0.0;
  }

  // calculate individual matrix coefficients
  const double aE = gamma / dx;
  const double aW = gamma / dx;
  const double aP = -1.0 * (aE + aW);

  // set individual matrix coefficients
  for (unsigned i = 1; i &lt; numberOfCells - 1; ++i) {
    coefficientMatrix.set(i, i, aP);
    coefficientMatrix.set(i, i + 1, aE);
    coefficientMatrix.set(i, i - 1, aW);
  }

  coefficientMatrix.set(0, 0, -1.0 * (aE + 2.0 * aW));
  coefficientMatrix.set(0, 1, aE);
  coefficientMatrix.set(numberOfCells - 1, numberOfCells - 2, aW);
  coefficientMatrix.set(numberOfCells - 1, numberOfCells - 1, -1.0 * (2.0 * aE + aW));

  // set boundary conditions
  boundaryConditions[0] = -2.0 * aW * boundaryValueLeft;
  boundaryConditions[numberOfCells - 1] = -2.0 * aE * boundaryValueRight;

  // solve the linear system using the conjugate gradient method
  linearAlgebraLib::ConjugateGradient CGSolver(numberOfCells);
  CGSolver.setCoefficientMatrix(coefficientMatrix);
  CGSolver.setRightHandSide(boundaryConditions);
  temperature = CGSolver.solve(100, 1e-10);

  // the obtain temperature profile is a linear one of the form T(x) = x. Thus, we can compare it directly against
  // the coordinate vector (which in this case acts as an analytic solution)
  linearAlgebraLib::Vector difference(numberOfCells);
  for (unsigned i = 0; i &lt; numberOfCells; ++i) {
    difference[i] += std::fabs(temperature[i] - coordinateX[i]);
  }

  // ensure that temperature has converged to at least single precision
  assert(difference.getL2Norm() &lt; 1e-8);

  std::cout &lt;&lt; &quot;Simulation successful, final residual: &quot; &lt;&lt; difference.getL2Norm() &lt;&lt; std::endl;
  return 0;
}" style="color:#D4D4D4;display:none" aria-label="Copy" class="code-block-pro-copy-button"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki dark-plus" style="background-color: #1E1E1E" tabindex="0"><code><span class="line"><span style="color: #C586C0">#include</span><span style="color: #569CD6"> </span><span style="color: #CE9178">&quot;linearAlgebraLib/linearAlgebraLib.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">// solve the heat equation implicitly of the form dT/dt = gamma * d^2 T/ dx^2</span></span>
<span class="line"><span style="color: #6A9955">// over a domain L using the conjugate gradient methdod</span></span>
<span class="line"><span style="color: #6A9955">// initial condition: 0 everywhere</span></span>
<span class="line"><span style="color: #6A9955">// boundary condition: T(0) = 0, T(L) = 1</span></span>
<span class="line"><span style="color: #569CD6">int</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">main</span><span style="color: #D4D4D4">() {</span></span>
<span class="line"><span style="color: #6A9955">  // input variables</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> gamma = </span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> numberOfCells = </span><span style="color: #B5CEA8">100</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> domainLength = </span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> boundaryValueLeft = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> boundaryValueRight = </span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> dx = domainLength / (numberOfCells);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // vectors and matrices</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::Vector </span><span style="color: #DCDCAA">coordinateX</span><span style="color: #D4D4D4">(numberOfCells);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::Vector </span><span style="color: #DCDCAA">temperature</span><span style="color: #D4D4D4">(numberOfCells);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::Vector </span><span style="color: #DCDCAA">boundaryConditions</span><span style="color: #D4D4D4">(numberOfCells);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::SparseMatrixCSR </span><span style="color: #DCDCAA">coefficientMatrix</span><span style="color: #D4D4D4">(numberOfCells, numberOfCells);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // initialise arrays and set-up 1D mesh</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; numberOfCells; ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">coordinateX</span><span style="color: #D4D4D4">[i] = i * dx + dx / </span><span style="color: #B5CEA8">2.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">temperature</span><span style="color: #D4D4D4">[i] = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">boundaryConditions</span><span style="color: #D4D4D4">[i] = </span><span style="color: #B5CEA8">0.0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // calculate individual matrix coefficients</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> aE = gamma / dx;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> aW = gamma / dx;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">double</span><span style="color: #D4D4D4"> aP = -</span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4"> * (aE + aW);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // set individual matrix coefficients</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">; i &lt; numberOfCells - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">; ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(i, i, aP);</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(i, i + </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, aE);</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(i, i - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, aW);</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, -</span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4"> * (aE + </span><span style="color: #B5CEA8">2.0</span><span style="color: #D4D4D4"> * aW));</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, aE);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(numberOfCells - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, numberOfCells - </span><span style="color: #B5CEA8">2</span><span style="color: #D4D4D4">, aW);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">coefficientMatrix</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">set</span><span style="color: #D4D4D4">(numberOfCells - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, numberOfCells - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">, -</span><span style="color: #B5CEA8">1.0</span><span style="color: #D4D4D4"> * (</span><span style="color: #B5CEA8">2.0</span><span style="color: #D4D4D4"> * aE + aW));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // set boundary conditions</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">boundaryConditions</span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">] = -</span><span style="color: #B5CEA8">2.0</span><span style="color: #D4D4D4"> * aW * boundaryValueLeft;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">boundaryConditions</span><span style="color: #D4D4D4">[numberOfCells - </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">] = -</span><span style="color: #B5CEA8">2.0</span><span style="color: #D4D4D4"> * aE * boundaryValueRight;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // solve the linear system using the conjugate gradient method</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::ConjugateGradient </span><span style="color: #DCDCAA">CGSolver</span><span style="color: #D4D4D4">(numberOfCells);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">CGSolver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setCoefficientMatrix</span><span style="color: #D4D4D4">(coefficientMatrix);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">CGSolver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">setRightHandSide</span><span style="color: #D4D4D4">(boundaryConditions);</span></span>
<span class="line"><span style="color: #D4D4D4">  temperature = </span><span style="color: #9CDCFE">CGSolver</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">solve</span><span style="color: #D4D4D4">(</span><span style="color: #B5CEA8">100</span><span style="color: #D4D4D4">, </span><span style="color: #B5CEA8">1e-10</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // the obtain temperature profile is a linear one of the form T(x) = x. Thus, we can compare it directly against</span></span>
<span class="line"><span style="color: #6A9955">  // the coordinate vector (which in this case acts as an analytic solution)</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">linearAlgebraLib</span><span style="color: #D4D4D4">::Vector </span><span style="color: #DCDCAA">difference</span><span style="color: #D4D4D4">(numberOfCells);</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">for</span><span style="color: #D4D4D4"> (</span><span style="color: #569CD6">unsigned</span><span style="color: #D4D4D4"> i = </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">; i &lt; numberOfCells; ++i) {</span></span>
<span class="line"><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">difference</span><span style="color: #D4D4D4">[i] += </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::</span><span style="color: #DCDCAA">fabs</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">temperature</span><span style="color: #D4D4D4">[i] - </span><span style="color: #9CDCFE">coordinateX</span><span style="color: #D4D4D4">[i]);</span></span>
<span class="line"><span style="color: #D4D4D4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">  // ensure that temperature has converged to at least single precision</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #DCDCAA">assert</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">difference</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getL2Norm</span><span style="color: #D4D4D4">() &lt; </span><span style="color: #B5CEA8">1e-8</span><span style="color: #D4D4D4">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::cout &lt;&lt; </span><span style="color: #CE9178">&quot;Simulation successful, final residual: &quot;</span><span style="color: #D4D4D4"> &lt;&lt; </span><span style="color: #9CDCFE">difference</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">getL2Norm</span><span style="color: #D4D4D4">() &lt;&lt; </span><span style="color: #4EC9B0">std</span><span style="color: #D4D4D4">::endl;</span></span>
<span class="line"><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">;</span></span>
<span class="line"><span style="color: #D4D4D4">}</span></span></code></pre></div>
<!-- /wp:kevinbatdorf/code-block-pro -->

<!-- wp:paragraph -->
<p>Lines 9-14 define some input variables and on lines 17-21 we define the vectors and coefficient matrix that we will need later to solve our linear system of equations. We construct a 1D mesh on lines 24-28, as well as initialise our vectors here. For the mesh, the integration points are located in between vertices. Thus, we first find the leftmost vertex with <code>i * dx</code> (at the first iteration, <code>i</code> is zero and so the vertex is located at [katex]x=0[/katex] and then add half the cell length to that vertex location with <code>dx / 2.0</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Returning back to the discretised equation we developed in <a href="https://cfd.university/learn/how-to-compiler-write-and-use-cfd-libraries-in-c/how-to-write-a-cfd-library-discretising-the-model-equation/" target="_blank" rel="noopener" title="">last week's article</a>, repeated below for convenience:</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>T_{i+1}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)+T_i^{n+1}\left(\frac{-2\Gamma A}{\Delta x}\right)+T_{i-1}^{n+1}\left(\frac{\Gamma A}{\Delta x}\right)=0</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>we see that we can define our coefficients on lines 31-33 based in the above equation, i.e. with the coefficient for [katex]T_{i}[/katex] being labelled [katex]a_P[/katex], and the coefficients for [katex]T_{i+1}[/katex] and [katex]T_{i-1}[/katex] being labelled as [katex]a_W[/katex] and [katex]a_E[/katex], respectively. You'll also notice that the coefficients on lines 31-33 do not contain the area of the cells [katex]A[/katex], since this is constant and thus can be divided in all terms so it will cancel out. We can also state that [katex]a_P= -(a_E + a_W)[/katex], which is shown on line 33.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On lines 36-40, we set the coefficients of the matrix but we ignore the first and last row (for now), as these need different treatment. This is evident by looking at the matrix definition again from above:</p>
<!-- /wp:paragraph -->

<!-- wp:katex/display-block -->
<div class="wp-block-katex-display-block katex-eq" data-katex-display="true"><pre>\begin{bmatrix}a_0 &amp; a_1 &amp; &amp; &amp; \dots &amp; 0 \\ a_0 &amp; a_1 &amp; a_2 &amp; &amp; &amp; \vdots \\ &amp; a_1 &amp;a_2 &amp; a_3 &amp; &amp; \\ &amp; &amp; &amp; \ddots &amp; &amp;\\ \vdots &amp; &amp; &amp; a_{k-2} &amp; a_{k-1} &amp; a_{k} \\ 0 &amp; \dots &amp;  &amp; &amp; a_{k-1} &amp; a_{k} \end{bmatrix} \begin{bmatrix}\phi_0 \\ \phi_1 \\ \phi_2 \\ \vdots \\ \phi_{k-1} \\ \phi_{k}\end{bmatrix} = \begin{bmatrix}b_0 \\ b_1 \\ b_2 \\ \vdots \\ b_{k-1} \\ b_{k}\end{bmatrix}</pre></div>
<!-- /wp:katex/display-block -->

<!-- wp:paragraph -->
<p>The first and last rows only contain two matrix coefficients, whereas internal rows contain three entries, and thus we treat them separately. Lines 42-43 add the missing first row coefficients, while lines 44-45 add the coefficients on the last row. Lines 48-49 set the right-hand side vector, called [katex]b[/katex] in the above matrix notation.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Once the matrix, temperature, and right-hand side vector are all set, we can create our linear system of equation solver on line 52, set the coefficient matrix, as well as the right-hand side vector, and then solve this system for the temperature. We specify two arguments to <code>solve()</code> function, the first being the maximum number of iterations, and the second the convergence threshold below which residuals must fall.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On lines 59-67, we essentially check that the results are correct. The behaviour of the heat diffusion equation is such that given two boundary points, a linear and smooth profile will be developed between these two boundary points for a steady state case. If we constrain the left boundary to have a value of <code>0</code>, and the right boundary to have a value of <code>1</code>, and then further let the grid start at <code>0</code> and go to <code>1</code>, then we can exploit the fact that at convergence, we should have the same <code>temperature=coordianteX</code>. This is shown in the figure below for different level of convergence.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":2028,"width":"583px","height":"auto","sizeSlug":"large","linkDestination":"none","align":"center"} -->
<figure class="wp-block-image aligncenter size-large is-resized"><img src="https://cfd.university/wp-content/uploads/2023/11/temperature_vs_coordinateX-1024x615.png" alt="" class="wp-image-2028" style="width:583px;height:auto"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Here, [katex]t_0[/katex] is our initial solution, and then each subsequent entry [katex]t_1[/katex], [katex]t_2[/katex], and [katex]t_3[/katex], represent some advancement in the solution. At [katex]t_3[/katex], we have found a steady state solution and we can see indeed how the temperature profile is a smooth variation between the left and right boundary value and that we have [katex]T=x[/katex]. Thus, we are able to judge convergence in this way.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading" id="aioseo-summary">Summary</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This article showed the basic library structure we'll use for our library. Pretty much all libraries you'll find out there will use a similar structure and so if we understand this week's article, you'll find yourself right at home once you start working with other CFD libraries. We briefly touched upon common software development practices in the form of test-driven development and software testing, and we provided our very own test that we'll use to ensure our library is working as intended. With this prerequisite out of the way, we are ready to develop some library code!</p>
<!-- /wp:paragraph -->